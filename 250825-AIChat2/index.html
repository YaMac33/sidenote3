<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>25.8.25 AI Chat2 レスポンシブ対応修正手順</title>
<style>
:root{
  --bg:#f6f8fc; --card:#fff; --ink:#0f1724; --muted:#607086;
  --accent:#2563eb; --ok:#16a34a; --warn:#f59e0b; --code-bg:#0b1220; --code-fg:#e6eef8; --border:#e7eef7;
}
*{box-sizing:border-box}
body{font-family:"Noto Sans JP",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;background:var(--bg);color:var(--ink);line-height:1.7}
.header{background:linear-gradient(90deg,#2563eb,#60a5fa);color:#fff;padding:18px 20px}
.header h1{margin:0;font-size:1.1rem}
.container{max-width:980px;margin:20px auto;padding:0 16px}
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:18px;box-shadow:0 6px 20px rgba(16,24,40,.05);margin-bottom:14px}
h2{margin:.2rem 0 8px;color:#123}
h3{margin:.6rem 0 6px;color:#0b2b52}
.small{font-size:.95rem;color:var(--muted)}
ol,ul{margin:0 0 10px 20px}
pre{background:var(--code-bg);color:var(--code-fg);padding:12px;border-radius:10px;overflow:auto;position:relative}
.copybtn{position:absolute;right:10px;top:8px;background:var(--accent);color:#fff;border:none;padding:6px 8px;border-radius:8px;cursor:pointer;font-size:.9rem}
.callout{border-left:4px solid var(--ok);background:#f0fdf4;padding:10px;border-radius:8px;margin:10px 0}
.warn{border-left:4px solid var(--warn);background:#fff7ed;padding:10px;border-radius:8px;margin:10px 0}
hr{border:none;border-top:1px solid var(--border);margin:14px 0}
.footer{color:var(--muted);text-align:center;padding:18px 10px;font-size:.92rem}
.kicker{display:inline-block;background:#eef2ff;border:1px solid #dbeafe;color:#1e3a8a;border-radius:999px;padding:2px 8px;font-size:.85rem;margin-bottom:6px}
</style>
</head>
<body>

<header class="header">
  <h1>25.08.25 レスポンシブ対応修正手順</h1>
</header>

<main class="container">

  <!-- Prompt -->
  <section class="card">
    <div class="kicker">あなた（プロンプト）</div>
    <p class="small">デプロイ成功。スマホ／タブレットでレイアウトが崩れるため、レスポンシブ対応の具体的修正手順（<code>index.html</code>・<code>style.css</code>・<code>script.js</code>）を知りたい。</p>
  </section>

  <!-- AI Answer Manualized -->
  <section class="card">
    <div class="kicker">AI（回答・マニュアル）</div>
    <h2>概要</h2>
    <p>現状はPC幅前提のレイアウトのため、スマホ／タブレットで崩れが発生。<strong>レスポンシブデザイン</strong>対応として、以下を実施します。</p>
    <ul>
      <li><strong>Step 1:</strong> <code>index.html</code> にビューポート指定を追加</li>
      <li><strong>Step 2:</strong> <code>style.css</code> にメディアクエリ（≤768px）を追加（全体最適の例を提示）</li>
      <li><strong>Step 3:</strong> <code>script.js</code> でルーム一覧に頭文字データ属性を付与</li>
      <li><strong>Step 4:</strong> 変更をGitHubへプッシュ → Renderの自動デプロイで反映</li>
    </ul>

    <hr />

    <h2>Step 1：<code>index.html</code> にビューポートを追加</h2>
    <p>スマホに「このページはスマホ対応」と伝える魔法の一行を <code>&lt;head&gt;</code> に追加します。</p>
    <pre id="code-index"><button class="copybtn" onclick="copyCode('code-index')">コピー</button><code>&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
  &lt;title&gt;ChatGPT風チャット&lt;/title&gt;
  &lt;link rel="stylesheet" href="/static/style.css"&gt;
&lt;/head&gt;
&lt;body&gt;

  &lt;div class="sidebar"&gt;
    &lt;h3&gt;ルーム&lt;/h3&gt;
    &lt;button id="new-chat-btn"&gt;新規チャット&lt;/button&gt;
    &lt;ul id="rooms"&gt;&lt;/ul&gt;
  &lt;/div&gt;

  &lt;div class="main-chat"&gt;
    &lt;div id="chat"&gt;&lt;/div&gt;
    &lt;div class="input-area"&gt;
      &lt;input id="prompt" placeholder="メッセージを入力..." /&gt;&lt;button id="send-btn"&gt;送信&lt;/button&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;script src="/static/script.js"&gt;&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre>

    <div class="callout"><strong>ポイント：</strong> この行（<code>&lt;meta name="viewport" ...&gt;</code>）がないと、スマホで拡大縮小表示となりCSSの意図が反映されません。</div>

    <hr />

    <h2>Step 2：<code>style.css</code> にレスポンシブCSSを追加</h2>
    <p>以下の内容で <code>static/style.css</code> を<strong>置き換え</strong>てください（末尾にスマホ向けメディアクエリを追加済み）。</p>
    <pre id="code-css"><button class="copybtn" onclick="copyCode('code-css')">コピー</button><code>/* ===== 全体のレイアウト ===== */
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  margin: 0;
  display: flex;
  height: 100vh;
  overflow: hidden; /* スクロールバーをbodyに出さない */
}

/* ===== サイドバー（ルーム一覧） ===== */
.sidebar {
  width: 240px;
  background-color: #f0f0f0;
  padding: 15px;
  border-right: 1px solid #ddd;
  display: flex;
  flex-direction: column;
  box-sizing: border-box; /* paddingを含めて幅を計算 */
  transition: width 0.3s ease; /* 幅が変わる時にアニメーション */
}

.sidebar h3 { margin-top: 0; }

#new-chat-btn {
  width: 100%;
  padding: 8px;
  margin-bottom: 15px;
  background-color: #007bff;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.2s;
}
#new-chat-btn:hover { background-color: #0056b3; }

#rooms {
  list-style: none;
  padding: 0;
  margin: 0;
  overflow-y: auto; /* ルームが増えたらスクロール */
}

#rooms li a {
  display: block;
  padding: 8px;
  text-decoration: none;
  color: #333;
  border-radius: 4px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
#rooms li a:hover { background-color: #e0e0e0; }

/* ===== メインのチャットウィンドウ ===== */
.main-chat {
  flex-grow: 1; /* 残りの幅をすべて使用 */
  display: flex;
  flex-direction: column;
  height: 100vh;
}

#chat {
  flex-grow: 1;
  padding: 10px; /* スマホ用に少し詰める */
  overflow-y: auto; /* メッセージが溢れたらスクロール */
  display: flex;
  flex-direction: column;
  gap: 10px; /* メッセージ間の余白 */
}

.input-area {
  padding: 10px; /* スマホ用に少し詰める */
  border-top: 1px solid #ddd;
  display: flex;
  gap: 10px;
}

#prompt {
  flex-grow: 1;
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 16px;
}

#send-btn {
  padding: 8px 15px;
  border: none;
  background-color: #28a745;
  color: white;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.2s;
}
#send-btn:hover { background-color: #218838; }
#send-btn:disabled { background-color: #aaa; cursor: not-allowed; }

/* ===== チャットメッセージのスタイル ===== */
.message {
  padding: 10px 15px;
  border-radius: 18px;
  max-width: 85%; /* スマホ用に少し広げる */
  word-wrap: break-word; /* 長い単語を折り返す */
  white-space: pre-wrap; /* 改行をそのまま表示 */
}

.user {
  background-color: #007bff;
  color: white;
  align-self: flex-end; /* 右寄せ */
}

.assistant {
  background-color: #e9e9eb;
  color: #000;
  align-self: flex-start; /* 左寄せ */
}

/* ============================================= */
/* ===== ↓↓↓ スマホ・タブレット用の設定 ↓↓↓ ===== */
/* ============================================= */
@media (max-width: 768px) {
  .sidebar {
    /* サイドバーを細くしてスペースを確保 */
    width: 60px;
    padding: 10px;
  }

  /* サイドバー内の文字を非表示にする */
  .sidebar h3,
  #rooms li a {
    font-size: 0; /* 文字サイズを0にして見えなくする */
  }

  /* 新規チャットボタンは文字を隠してアイコン風に */
  #new-chat-btn {
    font-size: 0; /* 文字を隠す */
    position: relative; /* 疑似要素の位置の基準にする */
  }

  /* 「＋」アイコンをCSSで描画 */
  #new-chat-btn::before {
    content: '+';
    font-size: 24px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }

  /* ルームのリンクは頭文字だけ表示 */
  #rooms li a::before {
    content: attr(data-initial); /* JSで設定する頭文字を表示 */
    font-size: 16px;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 100%;
  }
}</code></pre>

    <hr />

    <h2>Step 3：<code>script.js</code> で頭文字のデータ属性を付与</h2>
    <p>CSSが <code>data-initial</code> を参照できるよう、ルーム一覧生成時に1文字目を設定します。</p>
    <pre id="code-js"><button class="copybtn" onclick="copyCode('code-js')">コピー</button><code>// static/script.js の中の loadRooms 関数

async function loadRooms() {
  const res = await fetch("/rooms");
  const rooms = await res.json();
  roomsList.innerHTML = ""; // 一覧をクリア

  // 新しいものが上に来るように逆順で表示
  rooms.reverse().forEach(r =&gt; {
    const li = document.createElement("li");
    const a = document.createElement("a");
    a.href = "#";
    a.innerText = r.title;

    // ↓↓↓ CSSで使うための頭文字をdata属性として追加 ↓↓↓
    a.setAttribute("data-initial", (r.title || "").charAt(0) || "?");

    // 各リンクがクリックされたらselectRoom関数を呼び出す
    a.onclick = (event) =&gt; {
      event.preventDefault();
      selectRoom(r.id);
    };
    li.appendChild(a);
    roomsList.appendChild(li);
  });
}</code></pre>

    <div class="warn"><strong>注意：</strong> タイトルが空の可能性も考慮し、頭文字取得時はフォールバック（例：「<code>?</code>」）を入れておくと安全です。</div>

    <hr />

    <h2>Step 4：デプロイ</h2>
    <ol>
      <li><code>templates/index.html</code> に <code>&lt;meta name="viewport"&gt;</code> を追加</li>
      <li><code>static/style.css</code> を上記コードで置き換え</li>
      <li><code>static/script.js</code> の <code>loadRooms</code> を修正</li>
      <li>変更をGitHubへプッシュ → Renderの自動デプロイで反映</li>
    </ol>

    <div class="callout"><strong>結果：</strong> iPhone / iPad でも崩れず表示。サイドバーは省スペース化し、チャット領域の可読性を最優先に最適化されます。</div>
  </section>

  <section class="card">
    <h2>トラブルシュート（よくあるつまずき）</h2>
    <ul>
      <li><strong>スマホで変化しない：</strong> キャッシュを削除 / ハードリロード（PCのブラウザも含む）。</li>
      <li><strong>サイドバーが消えた：</strong> 768px以下で幅60pxに縮小します。意図通りの挙動です。</li>
      <li><strong>頭文字が表示されない：</strong> <code>data-initial</code> がセットされているか、タイトルが空でないか確認。</li>
    </ul>
  </section>

</main>

<footer class="footer">
  以上でレスポンシブ対応は完了です。必要ならさらにブレークポイント（例：&lt;=480px）を追加し、余白やフォントサイズを微調整してください。
</footer>

<script>
function copyCode(id){
  const el = document.getElementById(id);
  if(!el) return;
  const text = el.innerText;
  navigator.clipboard.writeText(text).then(()=>{
    const btn = el.querySelector('.copybtn');
    if(btn){
      const old = btn.textContent;
      btn.textContent = 'コピーしました';
      setTimeout(()=>btn.textContent = old, 1400);
    }
  }).catch(()=>{ alert('コピーに失敗しました。手動で選択してください。'); });
}
</script>

</body>
</html>
