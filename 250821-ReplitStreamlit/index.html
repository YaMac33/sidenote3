<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Replitã§AIãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã‚’ä½œæˆã™ã‚‹æ‰‹é †ï¼ˆHTMLç‰ˆï¼‰</title>
  <style>
    :root { --font: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans JP", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif; }
    body { font-family: var(--font); line-height: 1.7; margin: 0; color: #111; background: #fff; }
    header { padding: 2.2rem 1rem 0.5rem; text-align: center; }
    h1 { font-size: 1.6rem; margin: 0.2rem 0 0.8rem; }
    main { max-width: 960px; margin: 0 auto; padding: 1rem 1.2rem 3rem; }
    h2 { font-size: 1.25rem; margin-top: 2rem; border-left: 0.4rem solid #444; padding-left: 0.6rem; }
    h3 { font-size: 1.05rem; margin-top: 1.2rem; }
    ol, ul { padding-left: 1.4rem; }
    li { margin: 0.3rem 0; }
    .callout { background: #f5f7fb; border: 1px solid #dbe3f8; padding: 0.75rem 1rem; border-radius: 8px; }
    code, pre { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size: 0.95rem; }
    pre { background: #0e1116; color: #e6edf3; padding: 1rem; border-radius: 10px; overflow: auto; }
    pre code { background: none; color: inherit; }
    kbd { background: #eee; border: 1px solid #ccc; border-bottom-width: 2px; border-radius: 5px; padding: 0 0.35rem; font-size: 0.9em; }
    .steps { counter-reset: step; }
    .step { margin: 1.2rem 0 2rem; padding: 1rem; border: 1px solid #eee; border-radius: 12px; background: #fafafa; }
    .step > h2::before { counter-increment: step; content: "ã‚¹ãƒ†ãƒƒãƒ—" counter(step) "ï¼š"; color: #666; margin-right: 0.25rem; }
    footer { text-align: center; color: #666; font-size: 0.9rem; padding: 2rem 1rem; border-top: 1px solid #eee; }
    .emoji { margin-right: .3rem; }
  </style>
</head>
<body>
  <header>
    <h1>Replitã§ä½•ã‚‚ãªã„çŠ¶æ…‹ã‹ã‚‰AIãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã€å®Œæˆã•ã›ã‚‹ã¾ã§ã®æµã‚Œ</h1>
    <p class="callout">ä»¥ä¸‹ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ–‡ç« ã‚’ãƒ™ãƒ¼ã‚¹ã«HTMLåŒ–ã—ãŸæ‰‹é †æ›¸ã§ã™ã€‚</p>
  </header>

  <main class="steps">
    <section class="step" id="step-1">
      <h2><span class="emoji">ğŸ› ï¸</span>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æº–å‚™</h2>
      <p>ã¾ãšã€ã‚¢ãƒ—ãƒªã‚’é–‹ç™ºã™ã‚‹ãŸã‚ã®ã€Œä½œæ¥­å ´ã€ã‚’ç”¨æ„ã—ã¾ã™ã€‚</p>
      <ol>
        <li>
          <h3>æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹</h3>
          <ul>
            <li>Replitã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã€ã€Œ<strong>+ Create Repl</strong>ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¾ã™ã€‚</li>
            <li>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æ¤œç´¢çª“ã§ã€Œ<strong>Python</strong>ã€ã¨å…¥åŠ›ã—ã€è¡¨ç¤ºã•ã‚ŒãŸPythonãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠã—ã¾ã™ã€‚</li>
            <li><strong>Title</strong>ã«å¥½ããªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåï¼ˆä¾‹: <code>Notion-AI-Chat</code>ï¼‰ã‚’å…¥åŠ›ã—ã€ã€Œ<strong>Create Repl</strong>ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¾ã™ã€‚</li>
          </ul>
        </li>
        <li>
          <h3>å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹</h3>
          <ul>
            <li>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒä½œæˆã•ã‚ŒãŸã‚‰ã€ç”»é¢å³å´ã®ã€Œ<strong>Shell</strong>ã€ã‚¿ãƒ–ã‚’é–‹ãã¾ã™ã€‚</li>
            <li>ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚</li>
          </ul>
          <pre><code class="language-bash">pip install streamlit openai requests</code></pre>
        </li>
      </ol>
    </section>

    <section class="step" id="step-2">
      <h2><span class="emoji">ğŸ”‘</span>APIã‚­ãƒ¼ã®è¨­å®š</h2>
      <p>ã‚¢ãƒ—ãƒªãŒå¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆOpenAIã¨Notionï¼‰ã¨é€šä¿¡ã™ã‚‹ãŸã‚ã®ã€Œéµã€ã‚’è¨­å®šã—ã¾ã™ã€‚</p>
      <ol>
        <li>
          <h3>Secretsã‚’é–‹ã</h3>
          <p>Replitã®å·¦å´ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã‚ã‚‹éµã®ã‚¢ã‚¤ã‚³ãƒ³ã€Œ<strong>Secrets</strong>ã€ã‚’é–‹ãã¾ã™ã€‚</p>
        </li>
        <li>
          <h3>3ã¤ã®ç§˜å¯†æƒ…å ±ã‚’ç™»éŒ²ã™ã‚‹</h3>
          <ul>
            <li><strong>Key:</strong> <code>OPENAI_API_KEY</code>, <strong>Value:</strong> <code>sk-xxxx...</code></li>
            <li><strong>Key:</strong> <code>NOTION_API_KEY</code>, <strong>Value:</strong> <code>secret_xxxx...</code></li>
            <li><strong>Key:</strong> <code>NOTION_DATABASE_ID</code>, <strong>Value:</strong> <code>xxxxxxxx...</code></li>
          </ul>
        </li>
      </ol>
    </section>

    <section class="step" id="step-3">
      <h2><span class="emoji">ğŸ’»</span>ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°</h2>
      <p>æ¬¡ã«ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æœ¬ä½“ã¨ãªã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’æ›¸ãã¾ã™ã€‚</p>
      <ol>
        <li>
          <h3><code>app.py</code>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹</h3>
          <p>Replitã®ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã§ã€Œ<strong>+</strong>ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã€<code>app.py</code>ã¨ã„ã†åå‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚ï¼ˆæ—¢ã«<code>main.py</code>ãŒã‚ã‚Œã°ã€<code>app.py</code>ã«ãƒªãƒãƒ¼ãƒ ã—ã¦ã‚‚OKï¼‰</p>
        </li>
        <li>
          <h3>ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã‚‹</h3>
          <p>ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’<code>app.py</code>ã«ã‚³ãƒ”ãƒ¼ï¼†ãƒšãƒ¼ã‚¹ãƒˆã—ã¾ã™ã€‚</p>
          <pre><code class="language-python">import os
import openai
import requests
import json
import streamlit as st
from openai import OpenAI

# --- è¨­å®šã¨Secrets ---
st.set_page_config(page_title="My AIãƒãƒ£ãƒƒãƒˆ")
st.title("ğŸ¤– My AIãƒãƒ£ãƒƒãƒˆ")

# --- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®åˆæœŸåŒ– (Replitã¨Renderã®ä¸¡æ–¹ã§å‹•ãä»•çµ„ã¿) ---
try:
    # ã¾ãšReplitã®æ–¹æ³•(st.secrets)ã§èª­ã¿è¾¼ã¿ã‚’è©¦ã¿ã‚‹
    client = OpenAI(api_key=st.secrets["OPENAI_API_KEY"])
    notion_api_key = st.secrets["NOTION_API_KEY"]
    notion_database_id = st.secrets["NOTION_DATABASE_ID"]
except FileNotFoundError:
    # ã‚‚ã—å¤±æ•—ã—ãŸã‚‰(Renderã§ã¯ã“ã¡ã‚‰ãŒä½¿ã‚ã‚Œã‚‹)ã€æ¨™æº–çš„ãªæ–¹æ³•(os.getenv)ã§ç’°å¢ƒå¤‰æ•°ã‚’èª­ã¿è¾¼ã‚€
    client = OpenAI(api_key=os.getenv("OPENAI_API_KEY"))
    notion_api_key = os.getenv("NOTION_API_KEY")
    notion_database_id = os.getenv("NOTION_DATABASE_ID")

# --- Notioné€£æº ---
def save_to_notion(prompt, response):
    url = "https://api.notion.com/v1/pages"
    headers = {
        "Authorization": f"Bearer {notion_api_key}",
        "Content-Type": "application/json",
        "Notion-Version": "2022-06-28",
    }
    new_page_data = {
        "parent": {"database_id": notion_database_id},
        "properties": {
            "Prompt": {"title": [{"text": {"content": prompt}}]},
            "Response": {"rich_text": [{"text": {"content": response}}]},
        },
    }
    try:
        res = requests.post(url, headers=headers, data=json.dumps(new_page_data))
        res.raise_for_status()
        return True, "âœ… Notionã¸ã®ä¿å­˜ã«æˆåŠŸã—ã¾ã—ãŸï¼"
    except requests.exceptions.RequestException as e:
        return False, f"âŒ Notionã¸ã®ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}\nè©³ç´°: {res.text}"

# --- Streamlitãƒãƒ£ãƒƒãƒˆãƒ­ã‚¸ãƒƒã‚¯ ---
if "messages" not in st.session_state:
    st.session_state.messages = []

for message in st.session_state.messages:
    with st.chat_message(message["role"]):
        st.markdown(message["content"])

if prompt := st.chat_input("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"):
    st.session_state.messages.append({"role": "user", "content": prompt})
    with st.chat_message("user"):
        st.markdown(prompt)

    with st.chat_message("assistant"):
        message_placeholder = st.empty()
        completion = client.chat.completions.create(
            model="gpt-4",
            messages=[
                {"role": m["role"], "content": m["content"]}
                for m in st.session_state.messages
            ],
        )
        ai_response = completion.choices[0].message.content
        message_placeholder.markdown(ai_response)

    st.session_state.messages.append({"role": "assistant", "content": ai_response})

    success, message = save_to_notion(prompt, ai_response)
    if success:
        st.success(message)
    else:
        st.error(message)</code></pre>
        </li>
      </ol>
    </section>

    <section class="step" id="step-4">
      <h2><span class="emoji">ğŸš€</span>å®Ÿè¡Œã¨ãƒ‡ãƒãƒƒã‚°</h2>
      <ol>
        <li>
          <h3>ã‚¢ãƒ—ãƒªã‚’å®Ÿè¡Œã™ã‚‹</h3>
          <p>ç”»é¢å³å´ã®ã€Œ<strong>Shell</strong>ã€ã‚¿ãƒ–ã§ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</p>
          <pre><code class="language-bash">streamlit run app.py</code></pre>
        </li>
        <li>
          <h3>å‹•ä½œã‚’ç¢ºèªã™ã‚‹</h3>
          <ul>
            <li>Replitã«ã€Œ<strong>Webview</strong>ã€ãŒé–‹ãã€ä½œæˆã—ãŸã‚¢ãƒ—ãƒªãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</li>
            <li>å®Ÿéš›ã«ãƒãƒ£ãƒƒãƒˆã‚’å…¥åŠ›ã—ã€AIã‹ã‚‰è¿”ä¿¡ãŒæ¥ã‚‹ã“ã¨ã€ä¼šè©±å¾Œã«ç·‘è‰²ã®æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚</li>
          </ul>
        </li>
        <li>
          <h3>ãƒ‡ãƒãƒƒã‚°ã™ã‚‹</h3>
          <ul>
            <li>å•é¡ŒãŒèµ·ããŸå ´åˆã¯ã€å³å´ã®ã€Œ<strong>Console</strong>ã€ã‚¿ãƒ–ã«ã‚¨ãƒ©ãƒ¼ã®è©³ç´°ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚</li>
            <li>Consoleã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ’ãƒ³ãƒˆã«<code>app.py</code>ã‚„Secretsè¨­å®šã‚’è¦‹ç›´ã—ã€ä¿®æ­£ã—ã¾ã™ã€‚</li>
            <li>ä¿®æ­£å¾Œã¯Shellã§ <kbd>Ctrl</kbd> + <kbd>C</kbd> ã§åœæ­¢ã—ã€å†åº¦ <code>streamlit run app.py</code> ã‚’å®Ÿè¡Œã—ã¦ç¢ºèªã—ã¾ã™ã€‚å•é¡ŒãŒãªããªã‚‹ã¾ã§ç¹°ã‚Šè¿”ã—ã¾ã™ã€‚</li>
          </ul>
        </li>
      </ol>
    </section>

    <section class="step" id="step-5">
      <h2><span class="emoji">âœ…</span>å®Œæˆ</h2>
      <p>Webviewã§ã‚¢ãƒ—ãƒªãŒæ„å›³é€šã‚Šã«å‹•ä½œã—ã€ä¼šè©±ãŒNotionãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ­£ã—ãä¿å­˜ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸã‚‰ã€Replitã§ã®ã‚¢ãƒ—ãƒªä½œæˆã¯<strong>ã€Œå®Œæˆã€</strong>ã§ã™ã€‚<br />
      ã“ã®çŠ¶æ…‹ã«ãªã£ã¦åˆã‚ã¦ã€å…ˆã»ã©è§£èª¬ã—ãŸã€ŒRenderã§ã®ãƒ‡ãƒ—ãƒ­ã‚¤ä½œæ¥­ã€ã«é€²ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚</p>
    </section>
  </main>

  <footer>
    <p>Â© Your Project â€“ Replit Ã— Streamlit Ã— OpenAI Ã— Notion</p>
  </footer>
</body>
</html>
