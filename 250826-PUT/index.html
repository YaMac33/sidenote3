<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>25.8.27 PUTとPATCHの使い分け解説</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for better readability and aesthetics */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        
        h1, h2, h3 {
            font-weight: 700;
        }

        .code-block-container {
            position: relative;
            margin-top: 1rem;
            margin-bottom: 1rem;
        }

        .copy-button {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            background-color: #4a5568; /* gray-700 */
            color: white;
            font-size: 0.875rem;
            cursor: pointer;
            transition: background-color 0.2s;
            border: 1px solid #2d3748; /* gray-800 */
        }

        .copy-button:hover {
            background-color: #2d3748; /* gray-800 */
        }
        
        .copy-button.copied {
            background-color: #2f855a; /* green-700 */
        }

        pre {
            background-color: #1a202c; /* gray-900 */
            color: #e2e8f0; /* slate-200 */
            padding: 1.5rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        code {
            font-family: 'Menlo', 'Monaco', 'Consolas', "Courier New", monospace;
        }
        
        hr {
            border-color: #e2e8f0; /* slate-200 */
            margin-top: 2rem;
            margin-bottom: 2rem;
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-4xl">
        
        <header class="mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">25.8.27 PUTとPATCHの使い分け解説</h1>
        </header>

        <main class="bg-white p-6 sm:p-8 rounded-lg shadow-md">

            <blockquote class="border-l-4 border-slate-300 pl-4 py-2 my-4 bg-slate-50 text-gray-700">
                <p class="font-semibold">“ルーム名変更APIは PUT に統一しますか？それとも PATCH に変更しますか？“と問い合わせがあったんだけど、どういう意味？</p>
            </blockquote>
            
            <hr>

            <!-- Section 1: What is being asked -->
            <section>
                <h3 class="text-xl font-semibold mt-6 mb-2">なにを聞かれているか</h3>
                <p class="text-gray-700">「ルーム名を変更する API は <strong>PUT</strong> に統一するのか、それとも <strong>PATCH</strong> に変更するのか」という設計の質問です。つまり「同じエンドポイントでどの HTTP メソッドを使って、どういう意味の更新を行うのか」を決めたい、という意味です。</p>
            </section>
            
            <hr>

            <!-- Section 2: Meaning of PUT -->
            <section>
                <h3 class="text-xl font-semibold mt-6 mb-2">PUT の意味</h3>
                <ul class="list-disc list-inside space-y-2 text-gray-700">
                    <li><strong>全体を置換する</strong>操作とみなされます。つまりリソース全体の現在の状態を「新しい完全な表現」で送る必要があり、部分的な変更だけではなく、同時に他のフィールドも含めて更新・上書きします。</li>
                    <li>同じリクエストを繰り返しても結果は同じ（<strong>冪等性</strong>が高い）。</li>
                </ul>
            </section>

            <hr>

            <!-- Section 3: Meaning of PATCH -->
            <section>
                <h3 class="text-xl font-semibold mt-6 mb-2">PATCH の意味</h3>
                <ul class="list-disc list-inside space-y-2 text-gray-700">
                    <li>リソースの一部だけを更新する「<strong>部分的更新</strong>」を表します。今回のように名前だけを変える場合に適しています。</li>
                    <li>同じ PATCH リクエストを繰り返しても、適用の仕方次第で結果が変わることもあり得ますが、同一のパッチを再適用して同じ結果にするよう設計することも可能です。</li>
                    <li>JSON Patch の形式（具体的な操作列を並べる形式）や JSON Merge Patch 形式など、更新の表現方法がいくつかあります。</li>
                </ul>
            </section>

            <hr>

            <!-- Section 4: Practical Recommendation -->
            <section>
                <h3 class="text-xl font-semibold mt-6 mb-2">実用的な推薦</h3>
                <ul class="list-disc list-inside space-y-2 text-gray-700">
                    <li>ルーム名のような「部分的な更新」なら <strong>PATCH</strong> を使うのが自然です。エンドポイントは例として以下のようにします。
                        <div class="code-block-container">
                            <button class="copy-button" onclick="copyCode(this)">Copy</button>
<pre><code>PATCH /rooms/{id}</code></pre>
                        </div>
                        <p>ボディ例（JSON Merge Patch 形式）:</p>
                        <div class="code-block-container">
                            <button class="copy-button" onclick="copyCode(this)">Copy</button>
<pre><code>{ "name": "New Room Name" }</code></pre>
                        </div>
                    </li>
                    <li class="mt-4"><strong>PUT</strong> を使う場合は「リソース全体を新しい表現で送る」ことを前提にします。現在の他のフィールドの値を自分で埋め直して送る必要があります。
                        <div class="code-block-container">
                            <button class="copy-button" onclick="copyCode(this)">Copy</button>
<pre><code>PUT /rooms/{id}</code></pre>
                        </div>
                        <p>ボディ例:</p>
                        <div class="code-block-container">
                            <button class="copy-button" onclick="copyCode(this)">Copy</button>
<pre><code>{ "id": 123, "name": "New Room Name", "description": "...", ... }</code></pre>
                        </div>
                    </li>
                </ul>
            </section>

            <hr>

            <!-- Section 5: Tips for using both -->
            <section>
                <h3 class="text-xl font-semibold mt-6 mb-2">併用するときのコツ</h3>
                <ul class="list-disc list-inside space-y-2 text-gray-700">
                    <li>明確に分けると混乱が減ります。<strong>partial update には PATCH</strong>、<strong>全置換には PUT</strong>、という運用ルールをドキュメント化するとよいです。</li>
                    <li>もし将来、複数のフィールドを一度に更新する場面が増えるなら、PATCH のまま柔軟に対応するのが一般的です。</li>
                    <li>併用する場合は、エンティティの ETag/IQ（If-Match など）を使って同時更新の競合を防ぐと安心です。</li>
                </ul>
            </section>

            <hr>

            <!-- Section 6: Final Note -->
            <section>
                <p class="text-gray-700">もし実際のコードでの例が欲しければ、使ってる言語/フレームワーク（例: Node/Express, Python/Flask など）と現状のエンドポイントの雰囲気を教えてください。具体的なサンプルを用意します。</p>
            </section>
        </main>
    </div>

    <script>
        function copyCode(button) {
            const codeBlockContainer = button.parentElement;
            const codeElement = codeBlockContainer.querySelector('code');
            
            if (codeElement) {
                const textArea = document.createElement('textarea');
                textArea.value = codeElement.innerText;
                
                textArea.style.position = 'fixed';
                textArea.style.left = '-9999px';
                document.body.appendChild(textArea);
                
                textArea.select();
                try {
                    document.execCommand('copy');
                    button.textContent = 'Copied!';
                    button.classList.add('copied');
                    
                    setTimeout(() => {
                        button.textContent = 'Copy';
                        button.classList.remove('copied');
                    }, 2000);
                } catch (err) {
                    console.error('Failed to copy text: ', err);
                    button.textContent = 'Error';
                }
                
                document.body.removeChild(textArea);
            }
        }
    </script>

</body>
</html>
