name: Convert Markdown to HTML

on:
  push:
    branches:
      - main # mainブランチにpushされたときに実行

jobs:
  convert:
    runs-on: ubuntu-latest
    steps:
      # 1. リポジトリのコードをチェックアウト
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. Pandocを使って.mdを.htmlに変換
      - name: Convert markdown to html
        uses: docker://pandoc/core
        with:
          # リポジトリ内の全ての.mdファイルを探して、同じ名前の.htmlファイルに変換
          args: >-
            --standalone
            --shift-heading-level-by=-1
            --table-of-contents
            --metadata pagetitle="sidenote3"
            -o "index.html"
            "index.md"

      # 3. 変換して生成されたHTMLファイルをリポジトリにコミット
      - name: Commit files
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add .
          # 変更があった場合のみコミット
          git diff-index --quiet HEAD || git commit -m "Auto-convert MD to HTML"

      # 4. コミットしたファイルをリポジトリにプッシュ
      - name: Push changes
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: main
