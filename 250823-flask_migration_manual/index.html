<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>25.8.23 Streamlit â†’ Flask ç§»è¡Œãƒãƒ‹ãƒ¥ã‚¢ãƒ«ï¼ˆGoogleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆé€£æºç‰ˆï¼‰</title>
<style>
body { font-family: sans-serif; line-height: 1.7; margin: 0; padding: 20px; background: #f9f9f9; }
h1, h2, h3 { color: #333; }
section { margin-bottom: 40px; }
pre { background: #272822; color: #f8f8f2; padding: 15px; overflow-x: auto; border-radius: 6px; position: relative; }
code { font-family: monospace; }
.copy-btn {
  position: absolute; top: 8px; right: 8px; 
  background: #0b93f6; color: #fff; border: none;
  padding: 6px 10px; font-size: 12px; border-radius: 4px; cursor: pointer;
}
table { border-collapse: collapse; margin: 20px 0; }
th, td { border: 1px solid #ccc; padding: 8px 12px; text-align: left; }
th { background: #eee; }
</style>
<script>
function copyCode(btn){
  const codeBlock = btn.nextElementSibling.innerText;
  navigator.clipboard.writeText(codeBlock).then(()=>{
    btn.innerText = "ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ!";
    setTimeout(()=>btn.innerText = "ã‚³ãƒ”ãƒ¼", 1500);
  });
}
</script>
</head>
<body>

<h1>Streamlit â†’ Flask ç§»è¡Œãƒãƒ‹ãƒ¥ã‚¢ãƒ«ï¼ˆGoogleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆä¿å­˜ç‰ˆï¼‰</h1>

<section>
<h2>ãªãœFlaskã«ä½œã‚Šæ›¿ãˆã‚‹ã®ã‹ï¼Ÿ</h2>
<p><strong>Flaskã«ç§»è¡Œã™ã‚‹ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹é€Ÿåº¦ãŒå¤§å¹…ã«å‘ä¸Šã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚</strong></p>
<p>Streamlitã¯ç°¡å˜ã«UIã‚’ä½œã‚Œã‚‹åé¢ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã”ã¨ã«å…¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å†å®Ÿè¡Œã™ã‚‹ãŸã‚ã€AIãƒãƒ£ãƒƒãƒˆã®ã‚ˆã†ãªé »ç¹ãªå‡¦ç†ã§é€Ÿåº¦ä½ä¸‹ã—ãŒã¡ã§ã™ã€‚</p>
<p>ä¸€æ–¹ã€Flaskã¯å¿…è¦ãªå‡¦ç†ã ã‘ã‚’å‘¼ã³å‡ºã™ã€Œãƒ«ãƒ¼ãƒˆãƒ™ãƒ¼ã‚¹ã€ã®ä»•çµ„ã¿ãªã®ã§ç„¡é§„ãŒå°‘ãªãã€é«˜é€Ÿã§ã™ã€‚</p>

<ul>
<li><strong>Streamlitï¼ˆğŸƒâ€â™‚ï¸ä¸‡èƒ½é¸æ‰‹ï¼‰</strong>ï¼šæ¯å›å…¨ä½“ã‚’å†å®Ÿè¡Œ â†’ ç„¡é§„ãŒå¤šã„</li>
<li><strong>Flaskï¼ˆğŸ‘©â€ğŸ’¼å—ä»˜ä¿‚ï¼‰</strong>ï¼šå¿…è¦ãªé–¢æ•°ã ã‘å®Ÿè¡Œ â†’ é«˜é€Ÿã§åŠ¹ç‡çš„</li>
</ul>
</section>

<section>
<h2>ãƒ¡ãƒªãƒƒãƒˆãƒ»ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ</h2>
<h3>ãƒ¡ãƒªãƒƒãƒˆ</h3>
<ul>
<li>é«˜ã„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼ˆå¿…è¦ãªå‡¦ç†ã®ã¿å®Ÿè¡Œï¼‰</li>
<li>UIã‚’HTML/CSS/JSã§å®Œå…¨è‡ªç”±è¨­è¨ˆ</li>
<li>æ‹¡å¼µæ€§ãƒ»ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ãŒé«˜ã„</li>
<li>çŠ¶æ…‹ç®¡ç†ãŒæ˜ç¢ºã§åŠ¹ç‡çš„</li>
</ul>

<h3>ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ</h3>
<ul>
<li>é–‹ç™ºã‚¹ãƒ”ãƒ¼ãƒ‰ãŒè½ã¡ã‚‹ï¼ˆã‚³ãƒ¼ãƒ‰é‡å¢—åŠ ï¼‰</li>
<li>Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®å­¦ç¿’ãŒå¿…è¦</li>
</ul>

<h3>æ¯”è¼ƒè¡¨</h3>
<table>
<tr><th>é …ç›®</th><th>Flask</th><th>Streamlit</th></tr>
<tr><td>ãƒ¬ã‚¹ãƒãƒ³ã‚¹é€Ÿåº¦</td><td>é€Ÿã„</td><td>é…ã„å‚¾å‘</td></tr>
<tr><td>é–‹ç™ºã‚¹ãƒ”ãƒ¼ãƒ‰</td><td>ã‚„ã‚„é…ã„</td><td>éå¸¸ã«é€Ÿã„</td></tr>
<tr><td>UIè‡ªç”±åº¦</td><td>éå¸¸ã«é«˜ã„</td><td>åˆ¶é™ã‚ã‚Š</td></tr>
<tr><td>æ‹¡å¼µæ€§</td><td>é«˜ã„</td><td>ä½ã„</td></tr>
<tr><td>å­¦ç¿’ã‚³ã‚¹ãƒˆ</td><td>ã‚„ã‚„é«˜ã„</td><td>éå¸¸ã«ä½ã„</td></tr>
</table>
</section>

<section>
<h2>Flaskãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ</h2>
<pre><button class="copy-btn" onclick="copyCode(this)">ã‚³ãƒ”ãƒ¼</button><code>
/flask_chat_app
â”œâ”€â”€ .env
â”œâ”€â”€ app.py
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ /static
â”‚   â””â”€â”€ style.css
â””â”€â”€ /templates
    â””â”€â”€ index.html
</code></pre>
</section>

<section>
<h2>1. å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒª</h2>
<pre><button class="copy-btn" onclick="copyCode(this)">ã‚³ãƒ”ãƒ¼</button><code>
flask
openai
requests
python-dotenv
gspread
google-auth-oauthlib
</code></pre>
</section>

<section>
<h2>2. .envãƒ•ã‚¡ã‚¤ãƒ«</h2>
<pre><button class="copy-btn" onclick="copyCode(this)">ã‚³ãƒ”ãƒ¼</button><code>
OPENAI_API_KEY="sk-..."
GOOGLE_SHEET_ID="YOUR_SPREADSHEET_ID_HERE"
</code></pre>
</section>

<section>
<h2>3. CSSï¼ˆstatic/style.cssï¼‰</h2>
<pre><button class="copy-btn" onclick="copyCode(this)">ã‚³ãƒ”ãƒ¼</button><code>
body {
  background-color: #f0f0f0;
  font-family: sans-serif;
  margin: 0;
}
.chat-container {
  max-width: 750px; margin: auto; background-color: white;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
  display: flex; flex-direction: column; height: 100vh;
}
header { text-align: center; padding: 20px; border-bottom: 1px solid #ddd; }
.chat-box { flex-grow: 1; padding: 20px; overflow-y: auto; }
.user-bubble, .assistant-bubble {
  padding: 10px 14px; border-radius: 18px; margin: 5px 0;
  max-width: 75%; word-wrap: break-word;
}
.user-bubble { background-color: #0b93f6; color: white; margin-left: auto; }
.assistant-bubble { background-color: #e5e5ea; color: black; margin-right: auto; }
.input-area { display: flex; padding: 10px; border-top: 1px solid #ddd; }
.input-area input {
  flex-grow: 1; border-radius: 18px; padding: 10px 14px;
  border: 1px solid #ccc; margin-right: 10px;
}
.input-area button {
  border-radius: 18px; border: none; background-color: #0b93f6;
  color: white; padding: 10px 20px; cursor: pointer;
}
</code></pre>
</section>

<section>
<h2>4. HTMLï¼ˆtemplates/index.htmlï¼‰</h2>
<pre><button class="copy-btn" onclick="copyCode(this)">ã‚³ãƒ”ãƒ¼</button><code>
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ChatGPT with Flask</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="chat-container">
<header><h2>ChatGPT</h2></header>
<div class="chat-box" id="chat-box">
{% for message in messages %}
  {% if message.role == 'user' %}
    <div class="user-bubble">{{ message.content }}</div>
  {% else %}
    <div class="assistant-bubble">{{ message.content }}</div>
  {% endif %}
{% endfor %}
</div>
<div class="input-area">
<form method="POST" style="display: flex; width: 100%;">
<input type="text" name="prompt" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›" required autocomplete="off">
<button type="submit">é€ä¿¡</button>
</form>
</div>
</div>
<script>
const chatBox = document.getElementById('chat-box');
chatBox.scrollTop = chatBox.scrollHeight;
</script>
</body>
</html>
</code></pre>
</section>

<section>
<h2>5. Flaskãƒ­ã‚¸ãƒƒã‚¯ï¼ˆapp.pyï¼‰</h2>
<pre><button class="copy-btn" onclick="copyCode(this)">ã‚³ãƒ”ãƒ¼</button><code>
import os, openai
from flask import Flask, render_template, request, session
from openai import OpenAI
from dotenv import load_dotenv
import gspread

load_dotenv()
app = Flask(__name__)
app.config['SECRET_KEY'] = 'your-very-secret-key'

client = OpenAI(api_key=os.getenv("OPENAI_API_KEY"))
google_sheet_id = os.getenv("GOOGLE_SHEET_ID")

def save_to_google_sheet(prompt, response):
    try:
        gc = gspread.service_account(filename='service_account.json')
        sh = gc.open_by_key(google_sheet_id)
        ws = sh.sheet1
        ws.append_row([prompt, response])
        print("Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ä¿å­˜ã—ã¾ã—ãŸã€‚")
    except Exception as e:
        print("ä¿å­˜ã‚¨ãƒ©ãƒ¼:", e)

@app.route('/', methods=['GET','POST'])
def chat():
    if 'messages' not in session:
        session['messages'] = []
    if request.method == 'POST':
        prompt = request.form['prompt']
        session['messages'].append({"role":"user","content":prompt})
        completion = client.chat.completions.create(
            model="gpt-4o-mini",
            messages=session['messages']
        )
        ai_response = completion.choices[0].message.content
        session['messages'].append({"role":"assistant","content":ai_response})
        save_to_google_sheet(prompt, ai_response)
        session.modified = True
    return render_template('index.html', messages=session['messages'])

if __name__ == '__main__':
    app.run(debug=True)
</code></pre>
</section>

<section>
<h2>6. å®Ÿè¡Œæ–¹æ³•</h2>
<ol>
<li>ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ <code>pip install -r requirements.txt</code></li>
<li><code>flask run</code> ã‚’å®Ÿè¡Œ</li>
<li>ãƒ–ãƒ©ã‚¦ã‚¶ã§ <code>http://127.0.0.1:5000</code> ã‚’é–‹ã</li>
<li>ãƒãƒ£ãƒƒãƒˆé€ä¿¡ â†’ Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ä¿å­˜ã•ã‚Œã¾ã™</li>
</ol>
</section>

</body>
</html>
