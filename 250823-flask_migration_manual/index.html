<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Streamlitã‚¢ãƒ—ãƒªã‚’Flaskã«ç§»è¡Œã™ã‚‹ãƒãƒ‹ãƒ¥ã‚¢ãƒ«</title>
<style>
body {
  font-family: "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
  line-height: 1.7;
  background: #f9f9f9;
  color: #333;
  margin: 0;
  padding: 0;
}
header {
  background: #005bac;
  color: white;
  text-align: center;
  padding: 1.5em 1em;
}
main {
  max-width: 1000px;
  margin: auto;
  background: white;
  padding: 2em;
}
h1, h2, h3 {
  color: #005bac;
}
pre {
  background: #f0f0f0;
  padding: 1em;
  overflow-x: auto;
  border-radius: 6px;
  font-size: 0.9em;
}
code {
  font-family: monospace;
}
ul, ol {
  margin: 0 0 1.2em 1.5em;
}
table {
  border-collapse: collapse;
  width: 100%;
  margin: 1em 0;
}
th, td {
  border: 1px solid #ccc;
  padding: 0.6em;
  text-align: center;
}
th {
  background: #f0f0f0;
}
.highlight {
  background: #fff8dc;
  padding: 0.8em;
  border-left: 5px solid #ff9800;
  margin: 1.5em 0;
}
</style>
</head>
<body>
<header>
  <h1>Streamlitã‚¢ãƒ—ãƒªã‚’Flaskã«ç§»è¡Œã™ã‚‹ãƒãƒ‹ãƒ¥ã‚¢ãƒ«</h1>
</header>
<main>
  <h2>1. Flaskã«ç§»è¡Œã™ã‚‹ç†ç”±</h2>
  <p>
    Streamlitã§AIãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã‚’ä½œæˆã™ã‚‹ã¨ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã”ã¨ã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆå…¨ä½“ãŒå†å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
    Flaskã«ç§»è¡Œã™ã‚‹ã¨<strong>ä¸è¦ãªå†å®Ÿè¡ŒãŒãªããªã‚Šã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹é€Ÿåº¦ãŒå¤§å¹…ã«æ”¹å–„</strong>ã—ã¾ã™ã€‚
  </p>

  <h3>å®Ÿè¡Œãƒ¢ãƒ‡ãƒ«ã®é•ã„</h3>
  <ul>
    <li><strong>Streamlit ğŸƒâ€â™‚ï¸ï¼ˆçœŸé¢ç›®ãªä¸‡èƒ½é¸æ‰‹ï¼‰</strong><br>
      æ¯å›ã‚¹ã‚¯ãƒªãƒ—ãƒˆå…¨ä½“ã‚’å†å®Ÿè¡Œã€‚ãƒ¢ãƒ‡ãƒ«å†èª­ã¿è¾¼ã¿ãªã©ç„¡é§„ãŒå¤šã„ã€‚</li>
    <li><strong>Flask ğŸ‘©â€ğŸ’¼ï¼ˆå°‚é–€ã®å—ä»˜ä¿‚ï¼‰</strong><br>
      å¿…è¦ãªå‡¦ç†ã ã‘å®Ÿè¡Œã€‚UIå†æç”»ã‚„ä½™è¨ˆãªå‡¦ç†ã‚’ã›ãšé«˜é€Ÿå¿œç­”ã€‚</li>
  </ul>

  <h3>ãƒ¡ãƒªãƒƒãƒˆãƒ»ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ</h3>
  <h4>ãƒ¡ãƒªãƒƒãƒˆ</h4>
  <ul>
    <li>é«˜ã„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼ˆä¸è¦ãªå‡¦ç†ã‚’çœç•¥ï¼‰</li>
    <li>UIã‚’HTML/CSS/JSã§å®Œå…¨è‡ªç”±ã«è¨­è¨ˆå¯èƒ½</li>
    <li>é«˜ã„æ‹¡å¼µæ€§ãƒ»ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£</li>
    <li>ã‚µãƒ¼ãƒãƒ¼å´ã§ã®æ˜ç¢ºãªçŠ¶æ…‹ç®¡ç†</li>
  </ul>
  <h4>ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ</h4>
  <ul>
    <li>é–‹ç™ºé€Ÿåº¦ãŒä½ä¸‹ï¼ˆã‚³ãƒ¼ãƒ‰é‡å¢—åŠ ï¼‰</li>
    <li>Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®å­¦ç¿’ã‚³ã‚¹ãƒˆ</li>
  </ul>

  <table>
    <thead>
      <tr>
        <th>é …ç›®</th><th>Flask</th><th>Streamlit</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>ãƒ¬ã‚¹ãƒãƒ³ã‚¹é€Ÿåº¦</td><td>é€Ÿã„</td><td>é…ããªã‚‹å‚¾å‘</td></tr>
      <tr><td>é–‹ç™ºã‚¹ãƒ”ãƒ¼ãƒ‰</td><td>æ™‚é–“ãŒã‹ã‹ã‚‹</td><td>éå¸¸ã«é€Ÿã„</td></tr>
      <tr><td>UIè‡ªç”±åº¦</td><td>éå¸¸ã«é«˜ã„</td><td>åˆ¶é™ã‚ã‚Š</td></tr>
      <tr><td>æ‹¡å¼µæ€§</td><td>é«˜ã„ï¼ˆæœ¬ç•ªå‘ã‘ï¼‰</td><td>ä½ã„ï¼ˆè©¦ä½œå‘ã‘ï¼‰</td></tr>
      <tr><td>å­¦ç¿’ã‚³ã‚¹ãƒˆ</td><td>ã‚„ã‚„é«˜ã„</td><td>éå¸¸ã«ä½ã„</td></tr>
    </tbody>
  </table>

  <div class="highlight">
    <strong>çµè«–ï¼š</strong>
    ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã¯Streamlitã€æœ¬ç•ªé‹ç”¨ã‚„é«˜é€ŸåŒ–ãƒ»ç‹¬è‡ªUIã¯FlaskãŒé©åˆ‡ãªé¸æŠã§ã™ã€‚
  </div>

  <h2>2. Flaskã‚¢ãƒ—ãƒªã®ä½œã‚Šæ–¹</h2>

  <h3>2.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ</h3>
  <pre><code>/flask_chat_app
â”œâ”€â”€ .env
â”œâ”€â”€ app.py
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ /static
â”‚   â””â”€â”€ style.css
â””â”€â”€ /templates
    â””â”€â”€ index.html
</code></pre>

  <h3>2.2 å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒª</h3>
  <pre><code>flask
openai
requests
python-dotenv
</code></pre>
  <p>ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œ:</p>
  <pre><code>pip install -r requirements.txt</code></pre>

  <h3>2.3 ç’°å¢ƒå¤‰æ•°è¨­å®š</h3>
  <pre><code>.env
OPENAI_API_KEY="sk-..."
NOTION_API_KEY="secret_..."
NOTION_DATABASE_ID="..."
</code></pre>

  <h3>2.4 CSS (static/style.css)</h3>
  <pre><code>body {
  background-color: #f0f0f0;
  font-family: sans-serif;
  margin: 0;
}
.chat-container {
  max-width: 750px;
  margin: auto;
  background-color: white;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
  display: flex;
  flex-direction: column;
  height: 100vh;
}
header { text-align: center; padding: 20px; border-bottom: 1px solid #ddd; }
.chat-box { flex-grow: 1; padding: 20px; overflow-y: auto; }
.user-bubble, .assistant-bubble {
  padding: 10px 14px; border-radius: 18px; margin: 5px 0;
  max-width: 75%; word-wrap: break-word;
}
.user-bubble { background-color: #0b93f6; color: white; margin-left: auto; }
.assistant-bubble { background-color: #e5e5ea; color: black; margin-right: auto; }
.input-area { display: flex; padding: 10px; border-top: 1px solid #ddd; }
.input-area input {
  flex-grow: 1; border-radius: 18px; padding: 10px 14px;
  border: 1px solid #ccc; margin-right: 10px;
}
.input-area button {
  border-radius: 18px; border: none; background-color: #0b93f6;
  color: white; padding: 10px 20px; cursor: pointer;
}
</code></pre>

  <h3>2.5 HTML (templates/index.html)</h3>
  <pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
  &lt;title&gt;ChatGPT with Flask&lt;/title&gt;
  &lt;link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}"&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div class="chat-container"&gt;
    &lt;header&gt;&lt;h2&gt;ChatGPT&lt;/h2&gt;&lt;/header&gt;
    &lt;div class="chat-box" id="chat-box"&gt;
      {% for message in messages %}
        {% if message.role == 'user' %}
          &lt;div class="user-bubble"&gt;{{ message.content }}&lt;/div&gt;
        {% else %}
          &lt;div class="assistant-bubble"&gt;{{ message.content }}&lt;/div&gt;
        {% endif %}
      {% endfor %}
    &lt;/div&gt;
    &lt;div class="input-area"&gt;
      &lt;form method="POST" style="display:flex;width:100%;"&gt;
        &lt;input type="text" name="prompt" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" required autocomplete="off"&gt;
        &lt;button type="submit"&gt;é€ä¿¡&lt;/button&gt;
      &lt;/form&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;script&gt;
    const chatBox = document.getElementById('chat-box');
    chatBox.scrollTop = chatBox.scrollHeight;
  &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

  <h3>2.6 Flaskãƒ¡ã‚¤ãƒ³ã‚³ãƒ¼ãƒ‰ (app.py)</h3>
  <pre><code>import os, json, requests
from flask import Flask, render_template, request, session
from openai import OpenAI
from dotenv import load_dotenv

load_dotenv()
app = Flask(__name__)
app.config['SECRET_KEY'] = 'your-very-secret-key'

client = OpenAI(api_key=os.getenv("OPENAI_API_KEY"))
notion_api_key = os.getenv("NOTION_API_KEY")
notion_database_id = os.getenv("NOTION_DATABASE_ID")

def save_to_notion(prompt, response):
    url = "https://api.notion.com/v1/pages"
    headers = {
        "Authorization": f"Bearer {notion_api_key}",
        "Content-Type": "application/json",
        "Notion-Version": "2022-06-28",
    }
    data = {
        "parent": {"database_id": notion_database_id},
        "properties": {
            "Prompt": {"title": [{"text": {"content": prompt}}]},
            "Response": {"rich_text": [{"text": {"content": response}}]},
        },
    }
    try:
        res = requests.post(url, headers=headers, data=json.dumps(data))
        res.raise_for_status()
        print("Notionã«ä¿å­˜ã—ã¾ã—ãŸã€‚")
    except requests.exceptions.RequestException as e:
        print(f"Notionä¿å­˜ã‚¨ãƒ©ãƒ¼: {e}")

@app.route('/', methods=['GET', 'POST'])
def chat():
    if 'messages' not in session:
        session['messages'] = []
    if request.method == 'POST':
        prompt = request.form['prompt']
        session['messages'].append({"role": "user", "content": prompt})
        completion = client.chat.completions.create(
            model="gpt-4o-mini",
            messages=session['messages']
        )
        ai_response = completion.choices[0].message.content
        session['messages'].append({"role": "assistant", "content": ai_response})
        save_to_notion(prompt, ai_response)
        session.modified = True
    return render_template('index.html', messages=session['messages'])

if __name__ == '__main__':
    app.run(debug=True)
</code></pre>

  <h3>2.7 ã‚¢ãƒ—ãƒªã®å®Ÿè¡Œ</h3>
  <ol>
    <li>ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•</li>
    <li><code>pip install -r requirements.txt</code> ã‚’å®Ÿè¡Œï¼ˆåˆå›ã®ã¿ï¼‰</li>
    <li><code>flask run</code> ã‚’å®Ÿè¡Œ</li>
    <li>ãƒ–ãƒ©ã‚¦ã‚¶ã§ <code>http://127.0.0.1:5000</code> ã«ã‚¢ã‚¯ã‚»ã‚¹</li>
  </ol>

  <div class="highlight">
    ã“ã‚Œã§Streamlitã‚¢ãƒ—ãƒªã¨åŒç­‰æ©Ÿèƒ½ã‚’æŒã¤Flaskãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªãŒå®Œæˆã§ã™ï¼
  </div>
</main>
</body>
</html>
