<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNS収益・経費判定ガイド | インタラクティブ経費チェッカー</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #fafaf9; /* stone-50 */
            color: #1c1917; /* stone-900 */
        }
        /* Chart Container Styling - MANDATORY */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        /* Custom Utilities */
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            transition: transform 0.2s ease-in-out;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .nav-item.active {
            border-bottom: 2px solid #d97706; /* amber-600 */
            color: #d97706;
        }
    </style>
    <!-- Chosen Palette: Warm Neutral & Amber Focus (Background: stone-50, Text: stone-900, Accent: amber-600, Secondary: stone-500) -->
    <!-- Application Structure Plan:
        1.  **Header/Nav**: Simple navigation to jump between sections.
        2.  **Hero Section**: States the core value proposition ("Can I expense this?").
        3.  **Interactive Expense Checker (The Core)**: A "Status" + "Service" selector. This synthesizes Q1, Q2, and Q3 into a direct answer tool. It provides the "Yes/No", "Account Item", and "Advice" dynamically.
        4.  **Apportionment Simulator (Visualizing Logic)**: A section dedicated to the "Caution" points in Q1 and Q3. Uses a Doughnut chart and slider to demonstrate "Kaji-Anbun" (Business vs. Private use) and calculates deductible amounts in real-time.
        5.  **Tax Rule Comparison (Freelancer vs. Employee)**: Visualizes Q2. Uses a grid layout to compare "Business Income" vs. "Miscellaneous Income" and the "200k Rule".
        6.  **Evidence & Safety List**: A checklist section summarizing the "Evidence Preservation" points from all Qs.
    -->
    <!-- Visualization & Content Choices:
        1.  **Expense Checker**:
            * *Goal*: Inform/Decide.
            * *Method*: Dynamic DOM manipulation based on Dropdown inputs.
            * *Justification*: Users want a quick answer ("Can I expense note?"). A text-based interactive tool is faster than reading a long FAQ.
        2.  **Apportionment Simulator**:
            * *Goal*: Change/Calculate.
            * *Method*: Chart.js Doughnut Chart + Range Slider.
            * *Justification*: "70% Business" is abstract. Visualizing the split and the resulting yen amount clarifies the concept of "partial deduction".
        3.  **Income Classification Matrix**:
            * *Goal*: Compare.
            * *Method*: Styled HTML Grid with hover effects.
            * *Justification*: Comparison between Freelancer and Side-Hustle rules (Q2) is best understood side-by-side.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-stone-50 text-stone-800">

    <!-- Navigation -->
    <nav class="sticky top-0 z-50 bg-white/90 backdrop-blur shadow-sm border-b border-stone-200">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <span class="text-xl font-bold text-stone-800 tracking-tight">🧾 SNS経費ガイド</span>
                </div>
                <div class="hidden md:flex space-x-8 items-center">
                    <button onclick="scrollToSection('checker')" class="nav-item text-stone-600 hover:text-stone-900 px-3 py-2 text-sm font-medium transition-colors">経費判定機</button>
                    <button onclick="scrollToSection('simulation')" class="nav-item text-stone-600 hover:text-stone-900 px-3 py-2 text-sm font-medium transition-colors">家事按分シミュ</button>
                    <button onclick="scrollToSection('rules')" class="nav-item text-stone-600 hover:text-stone-900 px-3 py-2 text-sm font-medium transition-colors">副業のルール</button>
                </div>
                <!-- Mobile menu button stub (simplified for single file) -->
                <div class="md:hidden flex items-center">
                    <button onclick="scrollToSection('checker')" class="text-stone-600 p-2">▼</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="bg-white border-b border-stone-100">
        <div class="max-w-6xl mx-auto px-4 py-16 sm:px-6 lg:px-8 text-center">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-stone-900 mb-6 leading-tight">
                そのサブスク代、<br class="sm:hidden"><span class="text-amber-600">経費</span>にできる？
            </h1>
            <p class="text-lg sm:text-xl text-stone-600 max-w-2xl mx-auto mb-10">
                noteプレミアム、YouTube Premium、Gemini Advanced...<br>
                個人事業主や副業会社員がSNS収益を得るための費用は、正しく処理すれば節税になります。
            </p>
            <button onclick="scrollToSection('checker')" class="inline-flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-md text-white bg-amber-600 hover:bg-amber-700 shadow-lg transition-all transform hover:scale-105">
                今すぐチェックする
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-12 space-y-24">

        <!-- SECTION 1: Interactive Expense Checker -->
        <section id="checker" class="scroll-mt-24">
            <div class="text-center mb-10">
                <h2 class="text-3xl font-bold text-stone-900 mb-4">経費判定チェッカー</h2>
                <p class="text-stone-600 max-w-2xl mx-auto">
                    あなたの働き方と利用しているサービスを選ぶだけで、経費計上の可否、推奨される勘定科目、注意点を瞬時に判定します。
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Controls -->
                <div class="lg:col-span-1 space-y-6">
                    <div class="card p-6 bg-white border border-stone-200">
                        <label class="block text-sm font-medium text-stone-700 mb-2">① あなたの立場</label>
                        <select id="userTypeSelect" class="block w-full pl-3 pr-10 py-3 text-base border-stone-300 focus:outline-none focus:ring-amber-500 focus:border-amber-500 sm:text-sm rounded-md bg-stone-50 border">
                            <option value="freelancer">個人事業主 (専業)</option>
                            <option value="employee">会社員 (副業)</option>
                        </select>
                    </div>

                    <div class="card p-6 bg-white border border-stone-200">
                        <label class="block text-sm font-medium text-stone-700 mb-2">② 利用サービス</label>
                        <select id="serviceSelect" class="block w-full pl-3 pr-10 py-3 text-base border-stone-300 focus:outline-none focus:ring-amber-500 focus:border-amber-500 sm:text-sm rounded-md bg-stone-50 border">
                            <option value="note">note プレミアム / 定期購読</option>
                            <option value="youtube">YouTube Premium</option>
                            <option value="gemini">Gemini Advanced (AI)</option>
                        </select>
                    </div>

                    <div class="p-4 bg-amber-50 rounded-lg border border-amber-100">
                        <h4 class="font-bold text-amber-800 text-sm mb-1">💡 ヒント</h4>
                        <p class="text-amber-700 text-xs leading-relaxed">
                            「売上を得るために直接必要か」が最大の判断基準です。
                        </p>
                    </div>
                </div>

                <!-- Result Display -->
                <div class="lg:col-span-2">
                    <div id="resultCard" class="card h-full p-8 border-l-8 border-emerald-500 flex flex-col justify-between">
                        <div>
                            <div class="flex items-center justify-between mb-6">
                                <span id="verdictBadge" class="inline-flex items-center px-4 py-1 rounded-full text-sm font-bold bg-emerald-100 text-emerald-800">
                                    ◎ 経費計上可能
                                </span>
                                <span class="text-5xl opacity-20">📝</span>
                            </div>
                            
                            <h3 id="resultTitle" class="text-2xl font-bold text-stone-900 mb-4">note利用料の経費処理</h3>
                            
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mb-6">
                                <div>
                                    <span class="block text-xs font-semibold text-stone-400 uppercase tracking-wider">推奨勘定科目</span>
                                    <div id="accountItem" class="text-lg font-medium text-stone-800 mt-1">通信費 / 新聞図書費</div>
                                </div>
                                <div>
                                    <span class="block text-xs font-semibold text-stone-400 uppercase tracking-wider">主な利用目的</span>
                                    <div id="purpose" class="text-lg font-medium text-stone-800 mt-1">収益化機能・情報収集</div>
                                </div>
                            </div>

                            <hr class="border-stone-100 my-4">

                            <div class="prose prose-stone">
                                <p id="resultAdvice" class="text-stone-600 leading-relaxed">
                                    noteの機能（予約投稿、アクセス解析など）を売上向上のために使用している場合、全額または一部を経費にできます。情報収集目的であれば「新聞図書費」も適切です。
                                </p>
                            </div>
                        </div>

                        <div id="warningBox" class="mt-6 p-4 bg-stone-100 rounded-md border border-stone-200">
                            <h4 class="font-bold text-stone-700 text-sm mb-1">⚠️ 注意点</h4>
                            <p id="resultWarning" class="text-sm text-stone-600">
                                プライベート（趣味の閲覧）も兼ねている場合は、事業利用分のみを計算する「家事按分」が必要です。
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 2: Apportionment Simulator -->
        <section id="simulation" class="scroll-mt-24 bg-white rounded-2xl p-6 sm:p-10 shadow-sm border border-stone-200">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
                <div class="order-2 lg:order-1">
                    <h2 class="text-2xl font-bold text-stone-900 mb-4">家事按分（かじあんぶん）シミュレーター</h2>
                    <p class="text-stone-600 mb-6">
                        YouTube PremiumやAIツールなど、プライベートでも利用するサービスは「事業に使っている割合」だけを経費にします。
                        <br><br>
                        スライダーを動かして、事業利用率を決めてみましょう。
                    </p>

                    <div class="space-y-6">
                        <div>
                            <label class="flex justify-between text-sm font-medium text-stone-700 mb-2">
                                <span>月額料金 (例)</span>
                                <span class="font-bold">¥<span id="monthlyCostDisplay">1,280</span></span>
                            </label>
                            <input type="number" id="monthlyCostInput" value="1280" class="block w-full px-3 py-2 border border-stone-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500 sm:text-sm">
                        </div>

                        <div>
                            <label class="flex justify-between text-sm font-medium text-stone-700 mb-2">
                                <span>事業利用率 (%)</span>
                                <span id="usagePercentDisplay" class="font-bold text-amber-600">50%</span>
                            </label>
                            <input type="range" id="usageSlider" min="0" max="100" value="50" step="10" class="w-full h-2 bg-stone-200 rounded-lg appearance-none cursor-pointer accent-amber-600">
                            <div class="flex justify-between text-xs text-stone-400 mt-1">
                                <span>0% (全額私用)</span>
                                <span>100% (全額事業)</span>
                            </div>
                        </div>

                        <div class="bg-stone-50 p-4 rounded-lg border border-stone-200 text-center">
                            <span class="block text-xs text-stone-500 mb-1">経費にできる金額（月額）</span>
                            <span class="text-3xl font-bold text-stone-900">¥<span id="deductibleAmount">640</span></span>
                        </div>
                    </div>
                </div>

                <div class="order-1 lg:order-2 flex flex-col items-center">
                    <div class="chart-container">
                        <canvas id="apportionmentChart"></canvas>
                    </div>
                    <p class="text-xs text-stone-400 mt-4 text-center">
                        ※グラフは事業利用（経費）とプライベート利用（自己負担）の割合を示しています。
                    </p>
                </div>
            </div>
        </section>

        <!-- SECTION 3: Freelancer vs Employee Rules -->
        <section id="rules" class="scroll-mt-24">
            <div class="text-center mb-10">
                <h2 class="text-3xl font-bold text-stone-900 mb-4">会社員・副業の「ここが違う」</h2>
                <p class="text-stone-600 max-w-2xl mx-auto">
                    個人事業主（本業）と会社員（副業）では、税金のルールにいくつか違いがあります。<br>
                    特に「赤字」と「20万円ルール」の扱いに注意が必要です。
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Freelancer Card -->
                <div class="card p-6 border-t-4 border-stone-400">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-stone-900">🏢 個人事業主 (本業)</h3>
                        <span class="text-2xl">💼</span>
                    </div>
                    <ul class="space-y-4">
                        <li class="flex items-start">
                            <span class="flex-shrink-0 h-6 w-6 flex items-center justify-center rounded-full bg-stone-200 text-stone-600 text-xs font-bold mr-3">1</span>
                            <div>
                                <span class="block text-sm font-bold text-stone-800">事業所得</span>
                                <span class="text-sm text-stone-600">SNS収益は基本的に「事業所得」として申告します。</span>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <span class="flex-shrink-0 h-6 w-6 flex items-center justify-center rounded-full bg-stone-200 text-stone-600 text-xs font-bold mr-3">2</span>
                            <div>
                                <span class="block text-sm font-bold text-stone-800">損益通算ができる</span>
                                <span class="text-sm text-stone-600">赤字が出た場合、他の所得と相殺して税金を減らせる可能性があります。</span>
                            </div>
                        </li>
                    </ul>
                </div>

                <!-- Employee Card -->
                <div class="card p-6 border-t-4 border-amber-500 bg-amber-50/30">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-stone-900">💻 会社員 (副業)</h3>
                        <span class="text-2xl">👔</span>
                    </div>
                    <ul class="space-y-4">
                        <li class="flex items-start">
                            <span class="flex-shrink-0 h-6 w-6 flex items-center justify-center rounded-full bg-amber-200 text-amber-800 text-xs font-bold mr-3">1</span>
                            <div>
                                <span class="block text-sm font-bold text-stone-800">雑所得 (ざつしょとく)</span>
                                <span class="text-sm text-stone-600">規模が小さい場合、多くの副業収益は「雑所得」になります。</span>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <span class="flex-shrink-0 h-6 w-6 flex items-center justify-center rounded-full bg-amber-200 text-amber-800 text-xs font-bold mr-3">2</span>
                            <div>
                                <span class="block text-sm font-bold text-stone-800">損益通算は不可</span>
                                <span class="text-sm text-stone-600">経費がかさんで赤字になっても、給与所得（本業の給料）から引くことはできません。</span>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <span class="flex-shrink-0 h-6 w-6 flex items-center justify-center rounded-full bg-amber-200 text-amber-800 text-xs font-bold mr-3">3</span>
                            <div>
                                <span class="block text-sm font-bold text-stone-800">20万円ルール</span>
                                <span class="text-sm text-stone-600">
                                    「所得（利益）」が年間20万円以下なら所得税の確定申告は不要です。<br>
                                    <span class="text-xs text-stone-500 mt-1 block">※住民税の申告は必要です。</span>
                                </span>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- 200k Rule Visualizer -->
            <div class="mt-12 bg-white p-6 rounded-xl border border-stone-200">
                <h3 class="text-lg font-bold text-stone-900 mb-4 text-center">「20万円ルール」の誤解に注意！</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                     <div>
                        <p class="text-sm text-stone-600 mb-4">
                            申告不要の基準は「売上」ではなく<strong>「所得 (利益)」</strong>です。<br>
                            経費を正しく計上することで、申告義務がなくなる場合があります。
                        </p>
                        <div class="space-y-3 font-mono text-sm">
                            <div class="flex justify-between p-2 bg-stone-100 rounded">
                                <span>売上 (収入)</span>
                                <span class="font-bold">¥300,000</span>
                            </div>
                            <div class="flex justify-center text-stone-400">➖</div>
                            <div class="flex justify-between p-2 bg-amber-50 rounded text-amber-800 border border-amber-100">
                                <span>経費 (note代など)</span>
                                <span class="font-bold">-¥110,000</span>
                            </div>
                            <div class="flex justify-center text-stone-400">⬇</div>
                            <div class="flex justify-between p-3 bg-stone-800 text-white rounded">
                                <span>所得 (利益)</span>
                                <span class="font-bold">¥190,000</span>
                            </div>
                        </div>
                        <p class="text-xs text-right mt-2 text-emerald-600 font-bold">
                            ✨ 20万円以下なので、所得税の申告不要！
                        </p>
                    </div>
                     <div class="h-48 relative bg-stone-50 rounded border border-stone-200 flex items-end justify-center pb-4 px-4 space-x-4">
                        <!-- Chart bar mimicking CSS -->
                        <div class="w-20 bg-stone-300 rounded-t group relative h-3/4 transition-all duration-500 hover:bg-stone-400">
                            <div class="absolute bottom-full mb-1 w-full text-center text-xs font-bold text-stone-500">売上<br>30万</div>
                        </div>
                        <div class="w-20 bg-emerald-500 rounded-t group relative h-1/2 transition-all duration-500 hover:bg-emerald-600">
                            <div class="absolute top-4 w-full text-center text-white text-xs font-bold px-1">所得<br>19万</div>
                            <div class="absolute bottom-full mb-1 w-full text-center text-xs font-bold text-emerald-600">申告不要<br>ライン</div>
                             <!-- Limit line -->
                            <div class="absolute bottom-[105%] w-[300%] -left-[100%] border-t-2 border-dashed border-red-400 pointer-events-none"></div>
                            <div class="absolute bottom-[110%] -right-[150%] text-xs text-red-400 font-bold whitespace-nowrap">20万円の壁</div>
                        </div>
                     </div>
                </div>
            </div>
        </section>

        <!-- Footer / Evidence Section -->
        <footer class="border-t border-stone-200 pt-10 pb-6 text-center">
            <div class="max-w-2xl mx-auto mb-8">
                <h4 class="font-bold text-stone-900 mb-4">🧾 保存しておくべき証拠リスト</h4>
                <div class="flex flex-wrap justify-center gap-3">
                    <span class="px-3 py-1 bg-white border border-stone-300 rounded-full text-sm text-stone-600">クレジットカード明細</span>
                    <span class="px-3 py-1 bg-white border border-stone-300 rounded-full text-sm text-stone-600">note管理画面の支払履歴</span>
                    <span class="px-3 py-1 bg-white border border-stone-300 rounded-full text-sm text-stone-600">業務で使用したAIのログ</span>
                    <span class="px-3 py-1 bg-white border border-stone-300 rounded-full text-sm text-stone-600">リサーチ用再生リスト</span>
                </div>
            </div>
            <p class="text-xs text-stone-400">
                本ツールの判定結果は一般的なガイドラインです。個別の税務判断については、税理士または管轄の税務署にご相談ください。<br>
                Source: SNS収益と経費に関するQ&Aログ
            </p>
        </footer>

    </main>

    <!-- JavaScript Logic -->
    <script>
        // --- State Management ---
        const state = {
            userType: 'freelancer', // freelancer | employee
            service: 'note',        // note | youtube | gemini
            monthlyCost: 1280,
            usagePercent: 50
        };

        // --- Data Source (Based on provided Report) ---
        const logicData = {
            services: {
                note: {
                    title: "note プレミアム / 定期購読",
                    icon: "📝",
                    account: "通信費 / 新聞図書費",
                    purpose: "収益化機能・情報収集",
                    advice: "noteの機能（予約投稿、コメント制御、アクセス解析など）を使って売上を伸ばそうとしているなら、立派な事業経費です。情報収集目的での購読も対象になります。",
                    warning: "プライベートと兼用の場合（趣味の閲覧など）は、事業利用分のみを経費にする「家事按分」を行ってください。"
                },
                youtube: {
                    title: "YouTube Premium",
                    icon: "📺",
                    account: "通信費 / 新聞図書費",
                    purpose: "リサーチ効率化・教材視聴",
                    advice: "「広告カットによるリサーチ時間の短縮」「オフライン再生での学習」など、事業効率化の明確な理由があれば経費になります。",
                    warning: "娯楽利用の側面が強いため、noteよりも厳密な「家事按分」（例：事業3割、私用7割）と、リサーチ用再生リストなどの証拠保存が推奨されます。"
                },
                gemini: {
                    title: "Gemini Advanced (AI)",
                    icon: "🤖",
                    account: "通信費 / 消耗品費 / 支払手数料",
                    purpose: "記事構成・リサーチ・画像生成",
                    advice: "コンテンツ作成（ブログ、SNS、台本）の業務ツールとして使用している場合、noteと同様に経費として認められやすいです。",
                    warning: "プライベートな相談や遊びにも使っている場合は、使用頻度に応じて按分してください。"
                }
            },
            userTypes: {
                freelancer: {
                    badge: "◎ 経費計上可能",
                    badgeColor: "bg-emerald-100 text-emerald-800",
                    border: "border-emerald-500",
                    note: "「事業所得」の必要経費として計上します。"
                },
                employee: {
                    badge: "○ 経費計上可能 (条件あり)",
                    badgeColor: "bg-amber-100 text-amber-800",
                    border: "border-amber-500",
                    note: "「雑所得」の必要経費として計上します。赤字でも給与との相殺はできません。"
                }
            }
        };

        // --- Chart Initialization ---
        let apportionmentChart;

        function initCharts() {
            const ctx = document.getElementById('apportionmentChart').getContext('2d');
            
            Chart.defaults.font.family = "'Noto Sans JP', sans-serif";
            Chart.defaults.color = '#57534e'; // stone-600

            apportionmentChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['経費 (事業利用)', '自己負担 (プライベート)'],
                    datasets: [{
                        data: [50, 50],
                        backgroundColor: ['#d97706', '#e7e5e4'], // amber-600, stone-200
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.raw;
                                    const cost = state.monthlyCost;
                                    const amount = Math.round(cost * (value / 100));
                                    return ` ${value}% : ¥${amount.toLocaleString()}`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // --- Update Functions ---

        function updateChecker() {
            const sData = logicData.services[state.service];
            const uData = logicData.userTypes[state.userType];

            // Update Text Elements
            document.getElementById('resultTitle').textContent = sData.title;
            document.getElementById('accountItem').textContent = sData.account;
            document.getElementById('purpose').textContent = sData.purpose;
            document.getElementById('resultAdvice').textContent = sData.advice;
            document.getElementById('resultWarning').textContent = sData.warning;
            
            // Update Icon
            document.querySelector('#resultCard span.opacity-20').textContent = sData.icon;

            // Update Badge & Styles based on User Type
            const badge = document.getElementById('verdictBadge');
            badge.className = `inline-flex items-center px-4 py-1 rounded-full text-sm font-bold ${uData.badgeColor}`;
            badge.textContent = uData.badge;

            const card = document.getElementById('resultCard');
            // Remove old border classes
            card.classList.remove('border-emerald-500', 'border-amber-500');
            // Add new
            card.classList.add(uData.border);
        }

        function updateSimulation() {
            const business = parseInt(state.usagePercent);
            const private = 100 - business;
            const cost = parseInt(state.monthlyCost);
            const deductible = Math.floor(cost * (business / 100));

            // Update Text
            document.getElementById('monthlyCostDisplay').textContent = cost.toLocaleString();
            document.getElementById('usagePercentDisplay').textContent = `${business}%`;
            document.getElementById('deductibleAmount').textContent = deductible.toLocaleString();

            // Update Chart
            apportionmentChart.data.datasets[0].data = [business, private];
            apportionmentChart.update();
        }

        // --- Event Listeners ---

        document.addEventListener('DOMContentLoaded', () => {
            initCharts();

            // Checker Inputs
            document.getElementById('userTypeSelect').addEventListener('change', (e) => {
                state.userType = e.target.value;
                updateChecker();
            });

            document.getElementById('serviceSelect').addEventListener('change', (e) => {
                state.service = e.target.value;
                updateChecker();
            });

            // Simulator Inputs
            document.getElementById('monthlyCostInput').addEventListener('input', (e) => {
                state.monthlyCost = e.target.value;
                updateSimulation();
            });

            document.getElementById('usageSlider').addEventListener('input', (e) => {
                state.usagePercent = e.target.value;
                updateSimulation();
            });

            // Initial Update
            updateChecker();
            updateSimulation();
        });

        // Navigation Helper
        function scrollToSection(id) {
            const element = document.getElementById(id);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth' });
            }
        }

    </script>
</body>
</html>
