<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>25.8.26 script.jsã®ä¿®æ­£ã¨æ©Ÿèƒ½å®Ÿè£…ãƒãƒ‹ãƒ¥ã‚¢ãƒ«</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for better readability and aesthetics */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        
        h1, h2, h3 {
            font-weight: 700;
        }

        .code-block-container {
            position: relative;
            margin-top: 1rem;
            margin-bottom: 1rem;
        }

        .copy-button {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            background-color: #4a5568; /* gray-700 */
            color: white;
            font-size: 0.875rem;
            cursor: pointer;
            transition: background-color 0.2s;
            border: 1px solid #2d3748; /* gray-800 */
        }

        .copy-button:hover {
            background-color: #2d3748; /* gray-800 */
        }
        
        .copy-button.copied {
            background-color: #2f855a; /* green-700 */
        }

        pre {
            background-color: #1a202c; /* gray-900 */
            color: #e2e8f0; /* slate-200 */
            padding: 1.5rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        code {
            font-family: 'Menlo', 'Monaco', 'Consolas', "Courier New", monospace;
        }
        
        hr {
            border-color: #e2e8f0; /* slate-200 */
            margin-top: 2rem;
            margin-bottom: 2rem;
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-4xl">
        
        <header class="mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">25.8.27 script.jsã®ä¿®æ­£ã¨æ©Ÿèƒ½å®Ÿè£…ãƒãƒ‹ãƒ¥ã‚¢ãƒ«</h1>
            <p class="mt-2 text-gray-600">script.js ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æç”»éƒ¨åˆ†ãŒã‚ã‹ã£ãŸã®ã§ã€ä»¥ä¸‹ã®ä¿®æ­£ã§è¦æœ›ã™ã¹ã¦ã«å¯¾å¿œã§ãã¾ã™ã€‚</p>
        </header>

        <main class="bg-white p-6 sm:p-8 rounded-lg shadow-md">

            <!-- Section 1: Copy All Content -->
            <section>
                <h3 class="text-xl font-semibold mt-6 mb-2">1. å›ç­”å…¨ä½“ã‚’ãƒ¯ãƒ³ã‚¿ãƒƒãƒã‚³ãƒ”ãƒ¼</h3>
                <p class="text-gray-700"><code>appendMessage()</code> ã§ assistant ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å ´åˆã«ã‚³ãƒ”ãƒ¼ç”¨ãƒœã‚¿ãƒ³ã‚’è¿½åŠ ã—ã¾ã™ã€‚</p>
                <div class="code-block-container">
                    <button class="copy-button" onclick="copyCode(this)">Copy</button>
<pre><code class="language-javascript">
function appendMessage(role, text, timestamp = null) {
    const container = document.createElement("div");
    container.classList.add('message-container', role);

    const messageDiv = document.createElement("div");
    messageDiv.classList.add('message');

    if (role === 'user') {
        messageDiv.innerText = text;
    } else {
        // å›ç­”å…¨ä½“ã‚³ãƒ”ãƒ¼ç”¨ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
        const copyAllBtn = document.createElement('button');
        copyAllBtn.classList.add('copy-all-btn');
        copyAllBtn.title = "å›ç­”å…¨ä½“ã‚’ã‚³ãƒ”ãƒ¼";
        copyAllBtn.textContent = "ğŸ“‹";
        copyAllBtn.onclick = () => {
            navigator.clipboard.writeText(text).catch(err => console.error("ã‚³ãƒ”ãƒ¼å¤±æ•—:", err));
        };
        container.appendChild(copyAllBtn);

        messageDiv.innerHTML = formatMessageContent(text);
        // ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã«å€‹åˆ¥ã‚³ãƒ”ãƒ¼ã‚’ä»˜ä¸
        setTimeout(() => addCopyButtonsToCode(messageDiv), 0);
    }

    const timestampDiv = document.createElement("div");
    timestampDiv.classList.add('timestamp');
    timestampDiv.innerText = formatTimestamp(timestamp ? new Date(timestamp) : new Date());

    container.appendChild(messageDiv);
    container.appendChild(timestampDiv);
    chatWindow.appendChild(container);
    chatWindow.scrollTop = chatWindow.scrollHeight;
    return container;
}
</code></pre>
                </div>
            </section>
            
            <hr>

            <!-- Section 2: Copy Code Blocks -->
            <section>
                <h3 class="text-xl font-semibold mt-6 mb-2">2. ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã ã‘ã‚³ãƒ”ãƒ¼å¯èƒ½ã«ã™ã‚‹</h3>
                <p class="text-gray-700"><code>formatMessageContent()</code> ã§ <code>&lt;pre&gt;&lt;code&gt;</code> æ§‹é€ ã‚’ç”Ÿæˆã—ã€æç”»å¾Œã«ãƒœã‚¿ãƒ³ã‚’ä»˜ã‘ã‚‹é–¢æ•°ã‚’ä½œã‚Šã¾ã™ã€‚</p>
                <div class="code-block-container">
                    <button class="copy-button" onclick="copyCode(this)">Copy</button>
<pre><code class="language-javascript">
function formatMessageContent(text) {
    // HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ã¦ã‹ã‚‰ã‚³ãƒ¼ãƒ‰åŒ–
    const escapeHtml = (str) =>
        str.replace(/&/g, "&amp;")
           .replace(/</g, "&lt;")
           .replace(/>/g, "&gt;")
           .replace(/"/g, "&quot;")
           .replace(/'/g, "&#39;");

    const safeText = escapeHtml(text);

    return safeText
        .replace(/```([\s\S]*?)```/g, '&lt;pre&gt;&lt;code&gt;$1&lt;/code&gt;&lt;/pre&gt;')
        .replace(/`([^`\n]+)`/g, '&lt;code&gt;$1&lt;/code&gt;')
        .replace(/\n/g, '&lt;br&gt;');
}

function addCopyButtonsToCode(messageEl) {
    const codeBlocks = messageEl.querySelectorAll('pre');
    codeBlocks.forEach(pre => {
        const btn = document.createElement('button');
        btn.classList.add('copy-code-btn');
        btn.title = "ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼";
        btn.textContent = "ğŸ“‹";
        btn.onclick = () => {
            const codeText = pre.innerText;
            navigator.clipboard.writeText(codeText).catch(err => console.error("ã‚³ãƒ”ãƒ¼å¤±æ•—:", err));
        };
        pre.insertAdjacentElement('beforebegin', btn);
    });
}
</code></pre>
                </div>
                <div class="mt-4 p-4 bg-slate-100 rounded-md">
                    <h4 class="font-semibold text-gray-800">ãƒã‚¤ãƒ³ãƒˆ</h4>
                    <ul class="list-disc list-inside space-y-1 mt-2 text-gray-700">
                        <li><code>escapeHtml()</code> ã§ã‚¿ã‚°ã‚„å¤ªå­—ã‚’ç„¡åŠ¹åŒ–ï¼ˆè¦‹ãŸç›®ã¯ã‚³ãƒ¼ãƒ‰ã€æ©Ÿèƒ½ã¯å®‰å…¨ï¼‰ã€‚</li>
                        <li><code>innerHTML</code> ã«ç›´æ¥ä»£å…¥ã—ã¦ã‚‚HTMLãŒå®Ÿè¡Œã•ã‚Œãªã„ä»•æ§˜ã«ãªã‚‹ã€‚</li>
                    </ul>
                </div>
            </section>

            <hr>

            <!-- Section 3: API Methods -->
            <section>
                <h3 class="text-xl font-semibold mt-6 mb-2">3. ãƒ«ãƒ¼ãƒ åç§°å¤‰æ›´ãƒ»å‰Šé™¤APIã®HTTPãƒ¡ã‚½ãƒƒãƒ‰</h3>
                <ul class="list-disc list-inside space-y-2 text-gray-700">
                    <li>ã‚ãªãŸã® <code>script.js</code> ã¯ <code>PUT /rooms/:id</code> ã‚’å‘¼ã‚“ã§ã„ã¾ã™ãŒã€<code>app.py</code> å´ã¯ <code>PATCH</code> ã‚’å®Ÿè£…ã—ã¾ã™ï¼ˆPUTã§ã‚‚è‰¯ã„ã§ã™ãŒçµ±ä¸€ã—ã¾ã—ã‚‡ã†ï¼‰ã€‚</li>
                </ul>
                <div class="code-block-container">
                    <button class="copy-button" onclick="copyCode(this)">Copy</button>
<pre><code class="language-python">
@app.route("/rooms/&lt;room_id&gt;", methods=["PUT"])
def rename_room(room_id):
    ...
</code></pre>
                </div>
                <ul class="list-disc list-inside space-y-2 mt-4 text-gray-700">
                    <li>å‰Šé™¤APIã¯æ—¢ã« <code>DELETE</code> ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§ãã®ã¾ã¾ã§OKã§ã™ã€‚</li>
                </ul>
            </section>

            <hr>

            <!-- Section 4: CSS -->
            <section>
                <h3 class="text-xl font-semibold mt-6 mb-2">4. CSSã«è¿½åŠ ã™ã‚‹ã‚‚ã®</h3>
                <p class="text-gray-700">ã‚³ãƒ”ãƒ¼ç”¨ãƒœã‚¿ãƒ³ã‚’è¦‹ã‚„ã™ãã—ã¾ã™ï¼ˆä¾‹ï¼‰ï¼š</p>
                <div class="code-block-container">
                    <button class="copy-button" onclick="copyCode(this)">Copy</button>
<pre><code class="language-css">
.copy-all-btn, .copy-code-btn {
  cursor: pointer;
  background: #eee;
  border: none;
  padding: 2px 6px;
  margin: 2px;
  font-size: 0.9em;
  border-radius: 4px;
}
.copy-all-btn:hover, .copy-code-btn:hover {
  background: #ddd;
}
</code></pre>
                </div>
            </section>

            <hr>

            <!-- Section 5: app.py Summary -->
            <section>
                <h3 class="text-xl font-semibold mt-6 mb-2">5. app.py å´ã®ä¿®æ­£è¦ç‚¹ï¼ˆå†æ²ï¼‰</h3>
                <ul class="list-disc list-inside space-y-2 text-gray-700">
                    <li>ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã¯æ—¥æœ¬æ™‚é–“ã«ã™ã‚‹ï¼š
                        <div class="code-block-container">
                            <button class="copy-button" onclick="copyCode(this)">Copy</button>
<pre><code class="language-python">
from zoneinfo import ZoneInfo
now = datetime.datetime.now(ZoneInfo("Asia/Tokyo")).isoformat()
</code></pre>
                        </div>
                    </li>
                    <li>ãƒ«ãƒ¼ãƒ åç§°å¤‰æ›´APIã‚’ <code>PUT</code> ã«åˆã‚ã›ã‚‹ï¼š
                        <div class="code-block-container">
                            <button class="copy-button" onclick="copyCode(this)">Copy</button>
<pre><code class="language-python">
@app.route("/rooms/&lt;room_id&gt;", methods=["PUT"])
def rename_room(room_id):
    new_title = request.json.get("title")
    rows = sheet_rooms.get_all_values()
    ...
</code></pre>
                        </div>
                    </li>
                </ul>
            </section>
            
            <hr>

            <!-- Section 6: Final Outcome & Next Steps -->
            <section>
                <h2 class="text-2xl font-semibold border-b pb-2 mb-4">æœ€çµ‚æˆæœ</h2>
                <ul class="list-disc list-inside space-y-2 text-gray-700">
                    <li>å…¨å›ç­”ãƒ¯ãƒ³ã‚¿ãƒƒãƒã‚³ãƒ”ãƒ¼ â†’ assistantãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ãƒœã‚¿ãƒ³è¿½åŠ </li>
                    <li>ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯å˜ç‹¬ã‚³ãƒ”ãƒ¼ â†’ <code>&lt;pre&gt;&lt;code&gt;</code> å¤‰æ›ï¼‹å€‹åˆ¥ãƒœã‚¿ãƒ³è¿½åŠ </li>
                    <li>HTMLã‚¿ã‚°ã‚„å¤ªå­—ãŒã‚³ãƒ¼ãƒ‰å†…ã§ç„¡åŠ¹åŒ– â†’ <code>escapeHtml()</code> ã‚’å°å…¥</li>
                    <li>åç§°å¤‰æ›´ãƒ»å‰Šé™¤ã®å‹•ä½œAPIæ•´åˆæ€§ â†’ <code>PUT</code> or <code>PATCH</code>ã«çµ±ä¸€</li>
                    <li>æ—¥æœ¬æ™‚é–“ã§ã®ä¿å­˜ â†’ <code>ZoneInfo</code>ã‚’å°å…¥</li>
                </ul>

                <h3 class="text-xl font-semibold mt-6 mb-2">æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼š</h3>
                <ol class="list-decimal list-inside space-y-2 text-gray-700">
                    <li><code>app.py</code> ã«ä¸Šè¨˜ä¿®æ­£ã‚’å…¥ã‚Œã‚‹ï¼ˆã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã€æ—¥æœ¬èªã‚¿ã‚¤ãƒˆãƒ«å¤‰æ›´APIï¼‰ã€‚</li>
                    <li><code>script.js</code> ã‚’ã“ã®æ”¹è‰¯ç‰ˆã«ç½®ãæ›ãˆã‚‹ã€‚</li>
                    <li><code>style.css</code> ã«ã‚³ãƒ”ãƒ¼ç”¨ãƒœã‚¿ãƒ³ã®è¦‹ãŸç›®ã‚’è¿½åŠ ã™ã‚‹ã€‚</li>
                </ol>

                <h3 class="text-xl font-semibold mt-6 mb-2">å®Ÿè£…å¾Œã€å‹•ä½œç¢ºèªãƒã‚¤ãƒ³ãƒˆï¼š</h3>
                <ul class="list-disc list-inside space-y-2 text-gray-700">
                    <li>AIã®å›ç­”ã§ã‚³ãƒ¼ãƒ‰ãŒå‡ºãŸæ™‚ã«ãƒœã‚¿ãƒ³ãŒè¤‡æ•°å‡ºã‚‹ã‹ï¼Ÿ</li>
                    <li>ã€Œå›ç­”å…¨ä½“ã‚³ãƒ”ãƒ¼ã€ã§å…¨æ–‡ãŒå–ã‚Œã‚‹ã‹ï¼Ÿ</li>
                    <li>ã‚³ãƒ¼ãƒ‰ä¸­ã® <strong>**å¤ªå­—**</strong> ã‚„ <code>&lt;b&gt;</code> ãŒãŸã ã®æ–‡å­—åˆ—ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã‚‹ã‹ï¼Ÿ</li>
                </ul>
            </section>

            <hr>

            <!-- Section 7: Question -->
            <section>
                <h2 class="text-2xl font-semibold border-b pb-2 mb-4">è³ªå•</h2>
                <blockquote class="border-l-4 border-slate-300 pl-4 py-2 my-4 bg-slate-50 text-gray-700">
                    <p>app.py ã®ãƒ«ãƒ¼ãƒ åå¤‰æ›´APIã¯ PUT ã«çµ±ä¸€ã—ã¾ã™ã‹ï¼Ÿãã‚Œã¨ã‚‚ PATCH ã«å¤‰æ›´ã—ã¾ã™ã‹ï¼Ÿ<br>ï¼ˆscript.js å´ã«åˆã‚ã›ã¦ PUT å®Ÿè£…ã™ã‚‹ã®ãŒã‚·ãƒ³ãƒ—ãƒ«ã§ã™ï¼‰</p>
                </blockquote>
            </section>
        </main>
    </div>

    <script>
        function copyCode(button) {
            const codeBlockContainer = button.parentElement;
            const codeElement = codeBlockContainer.querySelector('code');
            
            if (codeElement) {
                const textArea = document.createElement('textarea');
                textArea.value = codeElement.innerText;
                
                textArea.style.position = 'fixed';
                textArea.style.left = '-9999px';
                document.body.appendChild(textArea);
                
                textArea.select();
                try {
                    // Use execCommand as a fallback for broader compatibility
                    document.execCommand('copy');
                    button.textContent = 'Copied!';
                    button.classList.add('copied');
                    
                    setTimeout(() => {
                        button.textContent = 'Copy';
                        button.classList.remove('copied');
                    }, 2000);
                } catch (err) {
                    console.error('Failed to copy text: ', err);
                    button.textContent = 'Error';
                }
                
                document.body.removeChild(textArea);
            }
        }
    </script>

</body>
</html>
