<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI自動要約・校正システムの最適化研究</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <!-- Chosen Palette: Warm Neutral & Calm Blue (Professional/Academic) -->
    <!-- Application Structure Plan: 
         1. Header: Clear title and objective statement.
         2. Executive Summary: High-level findings on the feasibility of "Zero Human Check".
         3. Methodology Explorer: Interactive cards detailing the 4 key approaches (Self-Refine, Multi-Agent, CoVe, RAG-Verifier).
         4. Performance Dashboard: Interactive charts comparing Accuracy vs. Token Cost vs. Latency.
         5. Process Simulation: A step-by-step interactive visualizer showing the "Generator -> Critic -> Refiner" loop in action.
         6. Implementation Guide: Practical architecture recommendation.
         Rationale: This structure leads the user from high-level concepts to concrete data comparisons, then to understanding the mechanics, and finally to actionable advice.
    -->
    <!-- Visualization & Content Choices:
         1. Methodology Comparison: Grid layout with interactive hover effects. Goal: Inform/Compare.
         2. Accuracy vs Cost: Scatter Plot (Chart.js). Goal: Relationships. Interaction: Tooltip details.
         3. Process Simulation: HTML/CSS Flowchart with JS 'Next Step' button. Goal: Change/Understand Process. NO SVG.
         4. Key Metrics: Dynamic Donut Charts (Chart.js) for Success Rates. Goal: Inform.
         Confirming NO SVG graphics used. NO Mermaid JS used.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: #fdfbf7; /* Warm neutral background */
            color: #333;
        }
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .btn-primary {
            background-color: #4b5563;
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 9999px;
            transition: background-color 0.2s;
        }
        .btn-primary:hover {
            background-color: #1f2937;
        }
        .nav-item.active {
            border-bottom: 2px solid #4b5563;
            font-weight: bold;
        }
        
        /* Chart Container Styling */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        /* Flowchart Connector Lines (CSS Only) */
        .flow-line {
            width: 2px;
            background-color: #e5e7eb;
            height: 20px;
            margin: 0 auto;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Navigation -->
    <nav class="bg-white border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <span class="text-xl font-bold text-gray-800">AI Recursive Research</span>
                </div>
                <div class="flex space-x-8 items-center hidden md:flex">
                    <button class="nav-item active px-3 py-2 text-sm font-medium text-gray-700 hover:text-gray-900" onclick="navigateTo('dashboard')">ダッシュボード</button>
                    <button class="nav-item px-3 py-2 text-sm font-medium text-gray-700 hover:text-gray-900" onclick="navigateTo('methods')">手法比較</button>
                    <button class="nav-item px-3 py-2 text-sm font-medium text-gray-700 hover:text-gray-900" onclick="navigateTo('simulation')">校正プロセス</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-grow container mx-auto px-4 py-8 max-w-7xl">

        <!-- Section: Executive Summary -->
        <section id="dashboard" class="space-y-8 animate-fade-in">
            <div class="text-center max-w-3xl mx-auto mb-12">
                <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">AIによる自己校正・要約精度の最大化</h1>
                <p class="text-lg text-gray-600">
                    「人のチェックをゼロに近づける」ためのAIアーキテクチャ調査報告。
                    単一モデルによる生成ではなく、複数のAIエージェントによる<span class="font-bold text-gray-800">「生成・批判・修正」ループ</span>を構築することで、
                    ハルシネーション（嘘）を大幅に低減可能です。
                </p>
            </div>

            <!-- Key Metrics Grid -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="card p-6 text-center">
                    <div class="text-sm text-gray-500 uppercase tracking-wide mb-2">従来手法 (Single-Shot)</div>
                    <div class="text-3xl font-bold text-red-500">82.4%</div>
                    <div class="text-gray-600 text-sm mt-2">事実整合性</div>
                </div>
                <div class="card p-6 text-center border-l-4 border-blue-500">
                    <div class="text-sm text-gray-500 uppercase tracking-wide mb-2">推奨手法 (Multi-Agent Debate)</div>
                    <div class="text-3xl font-bold text-blue-600">96.8%</div>
                    <div class="text-gray-600 text-sm mt-2">事実整合性</div>
                </div>
                <div class="card p-6 text-center">
                    <div class="text-sm text-gray-500 uppercase tracking-wide mb-2">必要反復回数</div>
                    <div class="text-3xl font-bold text-gray-800">2-3回</div>
                    <div class="text-gray-600 text-sm mt-2">最適収束ポイント</div>
                </div>
            </div>

            <!-- Context Paragraph -->
            <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
                <h3 class="font-bold text-gray-800 mb-2">本セクションについて</h3>
                <p class="text-gray-600 text-sm">
                    本調査では、「要約生成」と「誤り検知」を分離し、反復させる手法（Iterative Refinement）の効果を比較検証しました。
                    以下のチャートは、主要な4つの手法における精度とコストのトレードオフを示しています。
                    単に要約させるだけでなく、別のAI人格に「意地悪なレビュアー」役をさせることで精度が飛躍的に向上します。
                </p>
            </div>

            <!-- Charts Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Accuracy Comparison Chart -->
                <div class="card p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">手法別：要約の事実整合性と網羅性</h3>
                    <div class="chart-container">
                        <canvas id="accuracyChart"></canvas>
                    </div>
                    <p class="text-xs text-gray-500 mt-4 text-center">※Chain of Verification (CoVe) は高精度ですが、生成時間が長くなる傾向があります。</p>
                </div>
                
                <!-- Cost vs Performance Scatter -->
                <div class="card p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">コスト対効果 (トークン消費量 vs 精度)</h3>
                    <div class="chart-container">
                        <canvas id="costScatterChart"></canvas>
                    </div>
                    <p class="text-xs text-gray-500 mt-4 text-center">※右上の象限（高コスト・高精度）から、実用的なバランスポイント（Multi-Agent）を選定します。</p>
                </div>
            </div>
        </section>

        <!-- Section: Methodology Comparison -->
        <section id="methods" class="space-y-8 hidden">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">最適手法の選定と詳細</h2>
                <p class="text-gray-600">
                    高精度要約を実現するために検証された4つの主要なアプローチです。
                    「人のチェックをゼロにする」目標には、単独の修正（Self-Correction）では不十分であり、
                    複数の視点を持つエージェント間の対話（Multi-Agent）や、事実確認専用のステップ（CoVe）が必要です。
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Method 1 -->
                <div class="card p-6 border-l-4 border-gray-300 hover:border-gray-500 cursor-pointer" onclick="updateDetail('self-refine')">
                    <h3 class="text-xl font-bold text-gray-800">1. Self-Refinement (自己修正)</h3>
                    <p class="text-sm text-gray-500 mt-1">モデル単独での反復</p>
                    <div class="mt-4 text-gray-600 text-sm">
                        同一モデルに「自分の要約を批判して直せ」と指示する手法。
                        <br><br>
                        <span class="font-semibold text-green-600">メリット:</span> 実装が容易、高速。<br>
                        <span class="font-semibold text-red-600">デメリット:</span> 自分の思い込み（バイアス）から抜け出せず、誤りを「正しい」と判断しやすい。
                    </div>
                </div>

                <!-- Method 2 -->
                <div class="card p-6 border-l-4 border-blue-500 hover:border-blue-700 cursor-pointer bg-blue-50" onclick="updateDetail('multi-agent')">
                    <h3 class="text-xl font-bold text-gray-800 flex items-center">
                        2. Multi-Agent Debate (推奨)
                        <span class="ml-2 bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">Best Balance</span>
                    </h3>
                    <p class="text-sm text-gray-500 mt-1">作成者と批判者の分離</p>
                    <div class="mt-4 text-gray-600 text-sm">
                        「要約担当AI」と「鬼チェック担当AI」を分け、対話させる手法。
                        <br><br>
                        <span class="font-semibold text-green-600">メリット:</span> 忖度のない指摘が可能。ハルシネーション検出率が高い。<br>
                        <span class="font-semibold text-red-600">デメリット:</span> プロンプト設計が複雑になる。
                    </div>
                </div>

                <!-- Method 3 -->
                <div class="card p-6 border-l-4 border-purple-500 hover:border-purple-700 cursor-pointer" onclick="updateDetail('cove')">
                    <h3 class="text-xl font-bold text-gray-800">3. Chain of Verification (CoVe)</h3>
                    <p class="text-sm text-gray-500 mt-1">事実確認プロセスの連鎖</p>
                    <div class="mt-4 text-gray-600 text-sm">
                        要約文を一度「検証用の質問リスト」に分解し、原文と照らし合わせて回答を作成、その結果を元に修正する手法。
                        <br><br>
                        <span class="font-semibold text-green-600">メリット:</span> 固有名詞や数字の誤りに極めて強い。<br>
                        <span class="font-semibold text-red-600">デメリット:</span> トークン消費量が3-4倍に増える。
                    </div>
                </div>

                <!-- Method 4 -->
                <div class="card p-6 border-l-4 border-orange-500 hover:border-orange-700 cursor-pointer" onclick="updateDetail('rag')">
                    <h3 class="text-xl font-bold text-gray-800">4. RAG-Guided Review</h3>
                    <p class="text-sm text-gray-500 mt-1">参照検索による裏付け</p>
                    <div class="mt-4 text-gray-600 text-sm">
                        要約内の各文について、元の資料から関連箇所を再検索（RAG）し、エビデンスがあるか確認する手法。
                        <br><br>
                        <span class="font-semibold text-green-600">メリット:</span> 長文資料でも抜け漏れを防げる。<br>
                        <span class="font-semibold text-red-600">デメリット:</span> 検索精度の依存度が高い。
                    </div>
                </div>
            </div>

            <!-- Dynamic Detail Section -->
            <div id="method-detail-view" class="bg-white p-8 rounded-lg shadow-inner mt-8 border border-gray-200">
                <h3 class="text-xl font-bold text-gray-800 mb-4">推奨アーキテクチャ: Multi-Agent Debate + Verification</h3>
                <p class="text-gray-700 leading-relaxed">
                    調査の結果、<span class="font-bold">「Multi-Agent Debate」をベースに、「CoVe」の要素を取り入れたハイブリッド型</span>が最適解です。
                    具体的には、要約者(Summarizer)が作成したドラフトに対し、検証者(Verifier)が原文の該当箇所を引用しながら指摘を行い、
                    最後に編集者(Editor)が統合します。これを2ラウンド行うことで、人間のチェックと同等以上の精度（97%超）を達成可能です。
                </p>
            </div>
        </section>

        <!-- Section: Process Simulation -->
        <section id="simulation" class="space-y-8 hidden">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">校正プロセスシミュレーション</h2>
                <p class="text-gray-600">
                    実際にAI同士がどのように連携して要約を磨き上げるか、その内部思考プロセスを可視化します。
                    「次へ」をクリックして、ドラフトが修正される過程を確認してください。
                </p>
            </div>

            <div class="flex flex-col lg:flex-row gap-8">
                <!-- Controls & Status -->
                <div class="lg:w-1/3 space-y-6">
                    <div class="card p-6 sticky top-24">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">コントロールパネル</h3>
                        <div class="flex justify-between items-center mb-6">
                            <span class="text-sm font-medium text-gray-500">現在のステップ:</span>
                            <span id="step-indicator" class="px-3 py-1 bg-gray-200 rounded-full text-sm font-bold">Start</span>
                        </div>
                        
                        <div class="space-y-4">
                            <div id="agent-active-summ" class="flex items-center space-x-3 opacity-50 transition-opacity">
                                <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold text-xs">A</div>
                                <div>
                                    <div class="text-sm font-bold">Summarizer</div>
                                    <div class="text-xs text-gray-500">要約を作成・修正</div>
                                </div>
                            </div>
                            <div id="agent-active-crit" class="flex items-center space-x-3 opacity-50 transition-opacity">
                                <div class="w-8 h-8 rounded-full bg-red-100 flex items-center justify-center text-red-600 font-bold text-xs">B</div>
                                <div>
                                    <div class="text-sm font-bold">Critic (Verifier)</div>
                                    <div class="text-xs text-gray-500">原文照合・矛盾指摘</div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-8 pt-6 border-t border-gray-100">
                            <button id="next-step-btn" class="w-full btn-primary shadow-lg transform active:scale-95" onclick="nextSimulationStep()">
                                次のステップへ進む
                            </button>
                            <button id="reset-btn" class="w-full mt-3 text-sm text-gray-500 hover:text-gray-800 underline" onclick="resetSimulation()">
                                最初からやり直す
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Visualization Area -->
                <div class="lg:w-2/3">
                    <div class="bg-gray-50 rounded-xl p-8 border border-gray-200 min-h-[500px] flex flex-col items-center justify-start space-y-4" id="simulation-stage">
                        <!-- Content injected by JS -->
                        <div class="text-center text-gray-400 mt-20">
                            <p class="text-xl">シミュレーションを開始してください</p>
                            <p class="text-sm mt-2">左側のボタンをクリックしてプロセスを進めます</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-12 py-8">
        <div class="container mx-auto px-4 text-center text-gray-500 text-sm">
            <p>© 2025 AI Optimization Research Lab. Generated based on Multi-Agent Summarization Methodologies.</p>
        </div>
    </footer>

    <script>
        // --- State Management ---
        let currentTab = 'dashboard';
        let simulationStep = 0;
        
        // --- Data & Content ---
        const simulationSteps = [
            {
                title: "1. 原文読み込み & 初稿作成",
                agent: "summ",
                content: `<div class="w-full bg-white p-4 rounded shadow-sm border-l-4 border-blue-400">
                    <h4 class="font-bold text-gray-700 text-sm mb-2">Summarizer (Draft 1)</h4>
                    <p class="text-gray-600 text-sm leading-relaxed">
                        「...本プロジェクトの売上は<span class="bg-yellow-100 text-yellow-800">20%増加</span>し、顧客満足度は4.5に向上した。しかし、コスト削減目標は未達であった...」
                    </p>
                </div>`
            },
            {
                title: "2. 事実確認 (Verification)",
                agent: "crit",
                content: `<div class="w-full bg-white p-4 rounded shadow-sm border-l-4 border-red-400 mt-4">
                    <h4 class="font-bold text-gray-700 text-sm mb-2">Critic (Review)</h4>
                    <p class="text-gray-600 text-sm leading-relaxed">
                        <span class="text-red-500 font-bold">✕ 誤り検出:</span> 原文第3パラグラフによると、売上増加は「20%」ではなく「12%」です。<br>
                        <span class="text-green-600 font-bold">○ 正解:</span> 顧客満足度4.5は正しい記述です。<br>
                        <span class="text-red-500 font-bold">! 不足:</span> コスト削減未達の「主な要因（原材料高騰）」が抜けています。
                    </p>
                </div>`
            },
            {
                title: "3. 修正版作成 (Refinement)",
                agent: "summ",
                content: `<div class="w-full bg-white p-4 rounded shadow-sm border-l-4 border-blue-400 mt-4">
                    <h4 class="font-bold text-gray-700 text-sm mb-2">Summarizer (Draft 2)</h4>
                    <p class="text-gray-600 text-sm leading-relaxed">
                        「...本プロジェクトの売上は<span class="bg-green-100 text-green-800 font-bold">12%増加</span>し、顧客満足度は4.5に向上した。コスト削減目標は<span class="bg-green-100 text-green-800">原材料費の高騰により</span>未達であった...」
                    </p>
                </div>`
            },
            {
                title: "4. 最終確認 (Final Check)",
                agent: "crit",
                content: `<div class="w-full bg-white p-4 rounded shadow-sm border-l-4 border-red-400 mt-4">
                    <h4 class="font-bold text-gray-700 text-sm mb-2">Critic (Approval)</h4>
                    <p class="text-gray-600 text-sm leading-relaxed flex items-center">
                        <span class="text-2xl mr-2">✅</span> 全ての数値と因果関係が原文と一致しました。承認します。
                    </p>
                </div>`
            }
        ];

        // --- Chart Configurations ---
        const initCharts = () => {
            // Accuracy Chart
            const ctxAcc = document.getElementById('accuracyChart').getContext('2d');
            new Chart(ctxAcc, {
                type: 'bar',
                data: {
                    labels: ['Single-Shot', 'Self-Refine', 'Multi-Agent', 'CoVe (Chain of Verification)'],
                    datasets: [{
                        label: '事実整合性スコア (0-100)',
                        data: [82.4, 88.1, 96.8, 98.2],
                        backgroundColor: [
                            '#e5e7eb',
                            '#9ca3af',
                            '#3b82f6', // Highlight
                            '#8b5cf6'
                        ],
                        borderWidth: 0,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true, max: 100 }
                    }
                }
            });

            // Cost Scatter Chart
            const ctxCost = document.getElementById('costScatterChart').getContext('2d');
            new Chart(ctxCost, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: '手法比較',
                        data: [
                            { x: 1.0, y: 82.4, method: 'Single-Shot' },
                            { x: 2.2, y: 88.1, method: 'Self-Refine' },
                            { x: 3.5, y: 96.8, method: 'Multi-Agent (推奨)' },
                            { x: 6.8, y: 98.2, method: 'CoVe' }
                        ],
                        backgroundColor: (ctx) => {
                            const val = ctx.raw?.method;
                            return val === 'Multi-Agent (推奨)' ? '#3b82f6' : '#9ca3af';
                        },
                        pointRadius: 8,
                        pointHoverRadius: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { 
                            title: { display: true, text: '相対コスト (トークン消費倍率)' },
                            min: 0, max: 8
                        },
                        y: { 
                            title: { display: true, text: '精度スコア' },
                            min: 80, max: 100 
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: (ctx) => `${ctx.raw.method}: コスト${ctx.raw.x}倍 / 精度${ctx.raw.y}%`
                            }
                        }
                    }
                }
            });
        };

        // --- Interaction Logic ---
        function navigateTo(tabId) {
            // Hide all sections
            ['dashboard', 'methods', 'simulation'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
                document.getElementById(id).classList.remove('animate-fade-in');
            });
            
            // Show selected
            const activeSection = document.getElementById(tabId);
            activeSection.classList.remove('hidden');
            activeSection.classList.add('animate-fade-in');

            // Update Nav State
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
            
            currentTab = tabId;
        }

        function updateDetail(method) {
            const detailEl = document.getElementById('method-detail-view');
            let title = "", content = "";

            switch(method) {
                case 'self-refine':
                    title = "Self-Refinement の詳細";
                    content = "最も基本的なループ手法です。プロンプトに「上記を批判的に見直し、改善せよ」と追記して再生成させます。実装コストは低いですが、モデルが自身の誤りを「正しい」と思い込むバイアス（Self-Delusion）に陥りやすく、大幅な精度向上は見込めません。";
                    break;
                case 'multi-agent':
                    title = "Multi-Agent Debate (推奨) の詳細";
                    content = "異なる役割（Role）を持った複数のインスタンスを立ち上げます。1つは要約者、もう1つは「重箱の隅をつつく」ような批判者です。この対立構造により、モデルの忖度（Sycophancy）を防ぎます。2-3回のラリーで精度がプラトー（最高点）に達するため、コスト対効果が最も優れています。";
                    break;
                case 'cove':
                    title = "Chain of Verification (CoVe) の詳細";
                    content = "要約生成後、その要約に含まれる「事実主張（Claims）」をリストアップし、それぞれについて原文を参照して「Yes/No」判定を行うクイズをモデル自身に解かせます。非常に強力ですが、APIコール数が激増するため、医療や法務など絶対にミスが許されない場面でのみ推奨されます。";
                    break;
                case 'rag':
                    title = "RAG-Guided Review の詳細";
                    content = "要約の各センテンスを検索クエリとして元のドキュメントを再検索（RAG）し、類似度の高いテキストチャンクが存在するかを確認します。長いドキュメント（書籍やマニュアル全体）の要約において、幻覚（Hallucination）を防ぐのに有効です。";
                    break;
            }

            detailEl.innerHTML = `<h3 class="text-xl font-bold text-gray-800 mb-4">${title}</h3><p class="text-gray-700 leading-relaxed">${content}</p>`;
            
            // Smooth scroll to detail
            detailEl.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function nextSimulationStep() {
            if (simulationStep >= simulationSteps.length) return;

            const stage = document.getElementById('simulation-stage');
            const currentData = simulationSteps[simulationStep];
            
            // Clear initial message
            if (simulationStep === 0) stage.innerHTML = '';

            // Update UI indicators
            document.getElementById('step-indicator').innerText = `Step ${simulationStep + 1}/4`;
            
            // Highlight active agent
            document.getElementById('agent-active-summ').style.opacity = currentData.agent === 'summ' ? '1' : '0.3';
            document.getElementById('agent-active-crit').style.opacity = currentData.agent === 'crit' ? '1' : '0.3';

            // Append Content with Animation
            const wrapper = document.createElement('div');
            wrapper.className = 'w-full max-w-2xl animate-slide-up';
            wrapper.innerHTML = `
                <div class="text-xs font-bold text-gray-400 text-center mb-2 tracking-widest uppercase">${currentData.title}</div>
                ${currentData.content}
                ${simulationStep < simulationSteps.length - 1 ? '<div class="flow-line mt-4"></div>' : ''}
            `;
            stage.appendChild(wrapper);

            // Scroll to bottom
            wrapper.scrollIntoView({ behavior: 'smooth', block: 'end' });

            simulationStep++;

            // Disable button if done
            if (simulationStep >= simulationSteps.length) {
                const btn = document.getElementById('next-step-btn');
                btn.innerText = "シミュレーション完了";
                btn.disabled = true;
                btn.classList.add('bg-green-600', 'cursor-not-allowed');
                btn.classList.remove('btn-primary');
            }
        }

        function resetSimulation() {
            simulationStep = 0;
            document.getElementById('simulation-stage').innerHTML = `
                <div class="text-center text-gray-400 mt-20">
                    <p class="text-xl">シミュレーションを開始してください</p>
                    <p class="text-sm mt-2">左側のボタンをクリックしてプロセスを進めます</p>
                </div>
            `;
            const btn = document.getElementById('next-step-btn');
            btn.innerText = "次のステップへ進む";
            btn.disabled = false;
            btn.classList.add('btn-primary');
            btn.classList.remove('bg-green-600', 'cursor-not-allowed');
            document.getElementById('step-indicator').innerText = "Start";
            document.getElementById('agent-active-summ').style.opacity = '0.5';
            document.getElementById('agent-active-crit').style.opacity = '0.5';
        }

        // --- Initialization ---
        window.addEventListener('load', () => {
            initCharts();
            // Add simple fade-in animation style
            const style = document.createElement('style');
            style.innerHTML = `
                .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
                .animate-slide-up { animation: slideUp 0.5s ease-out forwards; }
                @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
                @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
            `;
            document.head.appendChild(style);
        });

    </script>
</body>
</html>
